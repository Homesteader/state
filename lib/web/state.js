var state=function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=8)}([function(t,e,n){"use strict";e.__esModule=!0;var r=n(10);e.assert=r.assert;var i=n(11);e.log=i.log;var o=n(12);e.random=o.random;var a=n(13);e.tree=a.tree},function(t,e,n){"use strict";e.__esModule=!0,function(t){t.Initial="initial",t.ShallowHistory="shallow history",t.DeepHistory="deep history",t.Junction="junction",t.Choice="choice"}(e.PseudoStateKind||(e.PseudoStateKind={}))},function(t,e,n){"use strict";e.__esModule=!0;var r=n(9);!function(t){t[t.external=0]="external",t[t.internal=1]="internal",t[t.local=2]="local"}(e.TransitionKind||(e.TransitionKind={})),function(t){t.map=[r.ExternalTransitionActivation,r.InternalTransitionActivation,r.LocalTransitionActivation]}(e.TransitionKind||(e.TransitionKind={}))},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});e.__esModule=!0;var o=n(0),a=n(6),s=n(7),u=n(5),c=n(2),f=function(t){function e(n,r){void 0===r&&(r=void 0);var i=t.call(this,n,r instanceof e?r.getDefaultRegion():r)||this;return i.children=[],i.onEnter=[],i.onLeave=[],i.deferrableTrigger=[],i.parent&&(o.assert.ok(!i.parent.children.filter(function(t){return t instanceof e&&t.name===i.name}).length,function(){return"State names must be unique within a region"}),i.parent.children.unshift(i)),o.log.info(function(){return"Created state "+i},o.log.Create),i}return i(e,t),e.prototype.getDefaultRegion=function(){return this.defaultRegion||(this.defaultRegion=new s.Region(this.name,this))},e.prototype.isSimple=function(){return 0===this.children.length},e.prototype.isComposite=function(){return this.children.length>=1},e.prototype.isOrthogonal=function(){return this.children.length>=2},e.prototype.isFinal=function(){return 0===this.outgoing.length},e.prototype.entry=function(t){return this.onEnter.unshift(t),this},e.prototype.exit=function(t){return this.onLeave.unshift(t),this},e.prototype.on=function(t){return new u.Transition(this,void 0,c.TransitionKind.internal,t)},e.prototype.when=function(t){return new u.Transition(this,void 0,c.TransitionKind.internal,void 0,t)},e.prototype.external=function(t){return this.to(t)},e.prototype.to=function(t){return void 0===t&&(t=void 0),new u.Transition(this,t)},e.prototype.internal=function(){return this.to()},e.prototype.local=function(t){return new u.Transition(this,t,c.TransitionKind.local)},e.prototype.defer=function(t){return this.deferrableTrigger.unshift(t),this},e.prototype.getTransition=function(t){for(var e,n=this,r=this.outgoing.length;r--;)this.outgoing[r].evaluate(t)&&(o.assert.ok(!e,function(){return"Multiple transitions found at "+n+" for "+t}),e=this.outgoing[r]);return e},e.prototype.enterHead=function(t,e,n,r){var i=this;if(r)for(var a=this.children.length;a--;)this.children[a]!==r&&this.children[a].enter(t,e,n);o.log.info(function(){return t+" enter "+i},o.log.Entry),t.setState(this);for(a=this.onEnter.length;a--;)this.onEnter[a](n)},e.prototype.enterTail=function(t,e,n){for(var r=this.children.length;r--;)this.children[r].enter(t,e,n);this.completion(t,e,this)},e.prototype.leave=function(t,e,n){for(var r=this,i=this.children.length;i--;)this.children[i].leave(t,e,n);o.log.info(function(){return t+" leave "+r},o.log.Exit);for(var a=this.onLeave.length;a--;)this.onLeave[a](n)},e.prototype.evaluate=function(t,e,n){var r=this.delegate(t,e,n)||this.accept(t,e,n)||this.doDefer(t,n);return r&&this.parent&&t.getState(this.parent)===this&&this.completion(t,e,this),r},e.prototype.delegate=function(t,e,n){for(var r=!1,i=this.children.length;i--&&(!t.getState(this.children[i]).evaluate(t,e,n)||(r=!0,!this.parent||t.getState(this.parent)===this)););return r},e.prototype.doDefer=function(t,e){var n=!1;return-1!==this.deferrableTrigger.indexOf(e.constructor)&&(t.defer(this,e),n=!0),n},e.prototype.completion=function(t,e,n){for(var r=this.children.length;r--;)if(!t.getState(this.children[r]).isFinal())return;this.accept(t,e,n)},e.prototype.toString=function(){return this.qualifiedName},e}(a.Vertex);e.State=f},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});e.__esModule=!0;var o=n(0),a=n(6),s=n(1),u=n(3),c=n(5),f=n(2),h=function(t){function e(e,n,r){void 0===r&&(r=s.PseudoStateKind.Initial);var i=t.call(this,e,n instanceof u.State?n.getDefaultRegion():n)||this;return i.kind=r,(i.kind===s.PseudoStateKind.Initial||i.isHistory())&&(o.assert.ok(!i.parent.starting,function(){return"Only one initial pseudo state is allowed in region "+i.parent}),i.parent.starting=i),i.parent.children.unshift(i),o.log.info(function(){return"Created "+i.kind+" pseudo state "+i},o.log.Create),i}return i(e,t),e.prototype.isHistory=function(){return this.kind===s.PseudoStateKind.DeepHistory||this.kind===s.PseudoStateKind.ShallowHistory},e.prototype.on=function(t){return new c.Transition(this,void 0,f.TransitionKind.internal,t)},e.prototype.when=function(t){return new c.Transition(this,void 0,f.TransitionKind.internal,void 0,t)},e.prototype.to=function(t){return new c.Transition(this,t)},e.prototype.external=function(t){return this.to(t)},e.prototype.else=function(t){var e=this;return o.assert.ok(this.kind===s.PseudoStateKind.Choice||this.kind===s.PseudoStateKind.Junction,function(){return"Else transitions are only valid at Choice and Junction pseudo states"}),o.assert.ok(!this.elseTransition,function(){return"Only 1 else transition allowed at "+e}),this.elseTransition=new c.Transition(this,t,f.TransitionKind.external,void 0,function(){return!1})},e.prototype.getTransition=function(t){var e=this.kind===s.PseudoStateKind.Choice?this.getChoiceTransition(t):this.getOtherTransition(t);if(!e)throw new Error("No outgoing transition found at "+this);return e},e.prototype.getChoiceTransition=function(t){for(var e=[],n=this.outgoing.length;n--;)this.outgoing[n].evaluate(t)&&e.push(this.outgoing[n]);return e[o.random.get(e.length)]||this.elseTransition},e.prototype.getOtherTransition=function(t){for(var e,n=this.outgoing.length;n--;)this.outgoing[n].evaluate(t)&&(e=this.outgoing[n]);return e||this.elseTransition},e.prototype.enterHead=function(t,e,n,r){var i=this;o.log.info(function(){return t+" enter "+i},o.log.Entry),t.setVertex(this)},e.prototype.enterTail=function(t,e,n){this.kind!==s.PseudoStateKind.Junction&&this.accept(t,e,n)},e.prototype.leave=function(t,e,n){var r=this;o.log.info(function(){return t+" leave "+r},o.log.Exit)},e.prototype.toString=function(){return this.qualifiedName},e}(a.Vertex);e.PseudoState=h},function(t,e,n){"use strict";e.__esModule=!0;var r=n(0),i=n(1),o=n(4),a=n(2),s=function(){function t(t,e,n,i,o){void 0===e&&(e=void 0),void 0===n&&(n=e?a.TransitionKind.external:a.TransitionKind.internal),void 0===i&&(i=void 0),void 0===o&&(o=function(){return!0});var s=this;this.userGuard=function(){return!0},this.actions=[],this.source=t,this.target=e||t,this.activation=new a.TransitionKind.map[n](this.source,this.target),this.typeGuard=i?function(t){return t.constructor===i}:function(){return!0},this.userGuard=o,t.outgoing.unshift(this),r.log.info(function(){return"Created "+s},r.log.Create)}return t.prototype.on=function(t){return this.typeGuard=function(e){return e.constructor===t},this},t.prototype.when=function(t){return this.userGuard=t,this},t.prototype.to=function(t,e){var n=this;return void 0===e&&(e=a.TransitionKind.external),this.target=t,this.activation=new a.TransitionKind.map[e](this.source,this.target),r.log.info(function(){return"- converted to "+n},r.log.Create),this},t.prototype.do=function(t){return this.actions.unshift(t),this},t.prototype.evaluate=function(t){return this.typeGuard(t)&&this.userGuard(t)},t.prototype.doActions=function(t){for(var e=this.actions.length;e--;)this.actions[e](t)},t.prototype.if=function(t){return this.when(t)},t.prototype.local=function(t){return void 0===t&&(t=void 0),(this.target=t||this.target)&&(this.activation=new a.TransitionKind.map[a.TransitionKind.local](this.source,this.target)),this},t.prototype.effect=function(t){return this.do(t)},t.prototype.traverse=function(t,e,n){for(var r=this,a=[r];r.target instanceof o.PseudoState&&r.target.kind===i.PseudoStateKind.Junction;)a.unshift(r=r.target.getTransition(n));for(var s=a.length;s--;)a[s].execute(t,e,n)},t.prototype.execute=function(t,e,n){var i=this;r.log.info(function(){return"Executing "+i},r.log.Transition),this.activation.exitSource(t,e,n),this.doActions(n),this.activation.enterTarget(t,e,n)},t.prototype.toString=function(){return this.activation+" transition from "+this.source+" to "+this.target},t}();e.Transition=s},function(t,e,n){"use strict";e.__esModule=!0;var r=function(){function t(t,e){this.name=t,this.parent=e,this.outgoing=[],this.qualifiedName=e?this.parent+"."+t:t}return t.prototype.isActive=function(t){return!this.parent||this.parent.parent.isActive(t)&&t.getVertex(this.parent)===this},t.prototype.enter=function(t,e,n){this.enterHead(t,e,n,void 0),this.enterTail(t,e,n)},t.prototype.accept=function(t,e,n){var r=!1,i=this.getTransition(n);return i&&(i.traverse(t,e,n),r=!0),r},t}();e.Vertex=r},function(t,e,n){"use strict";e.__esModule=!0;var r=n(0),i=n(1),o=function(){function t(t,e){var n=this;this.name=t,this.parent=e,this.children=[],this.qualifiedName=e+"."+t,this.parent.children.unshift(this),r.log.info(function(){return"Created region "+n},r.log.Create)}return t.prototype.enter=function(t,e,n){this.enterHead(t,e,n,void 0),this.enterTail(t,e,n)},t.prototype.enterHead=function(t,e,n,i){var o=this;r.log.info(function(){return t+" enter "+o},r.log.Entry)},t.prototype.enterTail=function(t,e,n){var o,a=this,s=this.starting;(e||this.starting&&this.starting.isHistory())&&(o=t.getState(this))&&(s=o,e=e||this.starting.kind===i.PseudoStateKind.DeepHistory),r.assert.ok(s,function(){return t+" no initial pseudo state found at "+a}),s.enter(t,e,n)},t.prototype.leave=function(t,e,n){var i=this;t.getVertex(this).leave(t,e,n),r.log.info(function(){return t+" leave "+i},r.log.Exit)},t.prototype.toString=function(){return this.qualifiedName},t}();e.Region=o},function(t,e,n){"use strict";e.__esModule=!0;var r=n(1);e.PseudoStateKind=r.PseudoStateKind;var i=n(2);e.TransitionKind=i.TransitionKind;var o=n(3);e.State=o.State;var a=n(4);e.PseudoState=a.PseudoState;var s=n(7);e.Region=s.Region;var u=n(5);e.Transition=u.Transition;var c=n(14);e.Instance=c.Instance;var f=n(0);e.log=f.log,e.random=f.random},function(t,e,n){"use strict";e.__esModule=!0;var r=n(0),i=n(4),o=n(3),a=function(){function t(t,e){var n=r.tree.ancestors(t,function(t){return t.parent}),o=r.tree.ancestors(e,function(t){return t.parent}),a=r.tree.lca(n,o)+1,s=o.length-(e instanceof i.PseudoState&&e.isHistory()?1:0);this.toExit=n[a],this.toEnter=o.slice(a,s).reverse()}return t.prototype.exitSource=function(t,e,n){this.toExit.leave(t,e,n)},t.prototype.enterTarget=function(t,e,n){for(var r=this.toEnter.length;r--;)this.toEnter[r].enterHead(t,e,n,this.toEnter[r-1]);this.toEnter[0].enterTail(t,e,n)},t.prototype.toString=function(){return"external"},t}();e.ExternalTransitionActivation=a;var s=function(){function t(t,e){this.target=e}return t.prototype.exitSource=function(t,e,n){for(this.vertexToEnter=this.target;this.vertexToEnter.parent&&!this.vertexToEnter.parent.parent.isActive(t);)this.vertexToEnter=this.vertexToEnter.parent.parent;!this.vertexToEnter.isActive(t)&&this.vertexToEnter.parent&&t.getVertex(this.vertexToEnter.parent).leave(t,e,n)},t.prototype.enterTarget=function(t,e,n){this.vertexToEnter&&!this.vertexToEnter.isActive(t)&&this.vertexToEnter.enter(t,e,n)},t.prototype.toString=function(){return"local"},t}();e.LocalTransitionActivation=s;var u=function(){function t(t,e){if(!(t instanceof o.State))throw new Error("Source of local transition must be a State.");this.source=t}return t.prototype.exitSource=function(t,e,n){},t.prototype.enterTarget=function(t,e,n){this.source.completion(t,e,this.source)},t.prototype.toString=function(){return"internal"},t}();e.InternalTransitionActivation=u},function(t,e,n){"use strict";e.__esModule=!0,function(t){t.ok=function(t,e){if(!t)throw new Error(e())}}(e.assert||(e.assert={}))},function(t,e,n){"use strict";e.__esModule=!0,function(t){t.Create=1,t.Entry=2,t.Exit=4,t.Evaluate=8,t.Transition=16,t.Transaction=32,t.User=64,t.All=t.Create|t.Entry|t.Exit|t.Evaluate|t.Transition|t.Transaction|t.User;var e=[];t.add=function(n,r){return void 0===r&&(r=t.All),e.push({callback:n,category:r})-1},t.remove=function(t){e[t]=void 0},t.info=function(t,n){for(var r,i=e.length;i--;){var o=e[i];o&&o.category&n&&o.callback(r||(r=t()))}}}(e.log||(e.log={}))},function(t,e,n){"use strict";e.__esModule=!0,function(t){t.get=function(t){return Math.floor(Math.random()*t)},t.set=function(e){var n=t.get;return t.get=e,n}}(e.random||(e.random={}))},function(t,e,n){"use strict";e.__esModule=!0,function(t){t.ancestors=function(t,e){for(var n=[];t;)n.unshift(t),t=e(t);return n},t.lca=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n&&t[r]===e[r];)r++;return r-(r!==n?1:2)}}(e.tree||(e.tree={}))},function(t,e,n){"use strict";e.__esModule=!0;var r=n(0),i=n(3),o=function(){function t(t,e,n){void 0===n&&(n=void 0);var i=this;this.name=t,this.root=e,this.cleanState={},this.dirtyState={},this.dirtyVertex={},this.deferredEventPool=[],r.assert.ok(!e.parent,function(){return"The state provided as the root for an instance cannot have a parent"}),n?this.transaction(function(){return i.stateFromJSON(i.root,n)}):this.transaction(function(){return i.root.enter(i,!1,i.root)})}return t.prototype.evaluate=function(t){var e=this;return r.log.info(function(){return e+" evaluate "+t},r.log.Evaluate),this.transaction(function(){var n=e.root.evaluate(e,!1,t);return n&&0!==e.deferredEventPool.length&&(e.evaluateDeferred(),e.deferredEventPool=e.deferredEventPool.filter(function(t){return t})),n})},t.prototype.defer=function(t,e){var n=this;r.log.info(function(){return n+" deferred "+e+" while in "+t},r.log.Evaluate),this.deferredEventPool.unshift(e)},t.prototype.evaluateDeferred=function(){for(var t=this,e=this.deferrableTriggers(this.root),n=function(n){var o=i.deferredEventPool[n];if(o&&-1===e.indexOf(o.constructor)&&(delete i.deferredEventPool[n],r.log.info(function(){return t+" evaluate deferred "+o},r.log.Evaluate),i.root.evaluate(i,!1,o)))return i.evaluateDeferred(),"break"},i=this,o=this.deferredEventPool.length;o--;){if("break"===n(o))break}},t.prototype.deferrableTriggers=function(t){var e=this;return t.children.reduce(function(t,n){return t.concat(e.deferrableTriggers(e.getState(n)))},t.deferrableTrigger)},t.prototype.transaction=function(t){try{for(var e=t(),n=Object.keys(this.dirtyState),r=n.length;r--;)this.cleanState[n[r]]=this.dirtyState[n[r]];return e}finally{this.dirtyState={},this.dirtyVertex={}}},t.prototype.setVertex=function(t){t.parent&&(this.dirtyVertex[t.parent.qualifiedName]=t)},t.prototype.setState=function(t){t.parent&&(this.dirtyVertex[t.parent.qualifiedName]=t,this.dirtyState[t.parent.qualifiedName]=t)},t.prototype.getState=function(t){return this.dirtyState[t.qualifiedName]||this.cleanState[t.qualifiedName]},t.prototype.getVertex=function(t){return this.dirtyVertex[t.qualifiedName]||this.cleanState[t.qualifiedName]},t.prototype.getLastKnownState=function(t){return this.cleanState[t.qualifiedName]},t.prototype.toJSON=function(t){var e=this;return void 0===t&&(t=this.root),{name:t.name,children:t.children.map(function(t){return e.regionToJSON(t)}).reverse()}},t.prototype.regionToJSON=function(t){var e=this,n=this.getLastKnownState(t);return{name:t.name,children:t.children.filter(function(t){return t instanceof i.State}).reverse().map(function(t){return e.toJSON(t)}),lastKnownState:n?n.name:void 0}},t.prototype.stateFromJSON=function(t,e){for(var n=function(n,o){var a=e.children[n],s=t.children.filter(function(t){return t.name===a.name})[0];r.assert.ok(s,function(){return"Unable to find region "+a.name}),i.regionFromJSON(s,a)},i=this,o=0,a=e.children.length;o<a;++o)n(o)},t.prototype.regionFromJSON=function(t,e){for(var n=function(n,a){var s=e.children[n],u=t.children.filter(function(t){return t instanceof i.State&&t.name===s.name})[0];r.assert.ok(u,function(){return"Unable to find state "+s.name}),o.stateFromJSON(u,s),u.name===e.lastKnownState&&o.setState(u)},o=this,a=0,s=e.children.length;a<s;++a)n(a)},t.prototype.toString=function(){return this.name},t}();e.Instance=o}]);