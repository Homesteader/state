var state=function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=10)}([function(t,e,n){"use strict";e.__esModule=!0;var i=n(11);e.assert=i.assert;var r=n(12);e.log=r.log;var o=n(13);e.random=o.random;var a=n(14);e.tree=a.tree},function(t,e,n){"use strict";e.__esModule=!0;var i=n(7);!function(t){t.external=i.ExternalTransitionActivation,t.internal=i.InternalTransitionActivation,t.local=i.LocalTransitionActivation}(e.TransitionKind||(e.TransitionKind={}))},function(t,e,n){"use strict";e.__esModule=!0;var i=n(0),r=n(6),o=n(3),a=n(1),s=function(){function t(e,n){void 0===n&&(n=void 0);var r=this;this.name=e,this.outgoing=[],this.children=[],this.onEnter=[],this.onLeave=[],this.deferrableTrigger=[],this.parent=n instanceof t?n.getDefaultRegion():n,this.parent?(i.assert.ok(!this.parent.children.filter(function(e){return e instanceof t&&e.name===r.name}).length,function(){return"State names must be unique within a region"}),this.qualifiedName=this.parent+"."+e,this.parent.children.unshift(this)):this.qualifiedName=e,i.log.info(function(){return"Created state "+r},i.log.Create)}return t.prototype.getDefaultRegion=function(){return this.defaultRegion||(this.defaultRegion=new r.Region(this.name,this))},t.prototype.isSimple=function(){return 0===this.children.length},t.prototype.isComposite=function(){return this.children.length>=1},t.prototype.isOrthogonal=function(){return this.children.length>=2},t.prototype.isFinal=function(){return 0===this.outgoing.length},t.prototype.entry=function(t){return this.onEnter.unshift(t),this},t.prototype.exit=function(t){return this.onLeave.unshift(t),this},t.prototype.on=function(t){return new o.Transition(this,void 0,a.TransitionKind.internal,t)},t.prototype.when=function(t){return new o.Transition(this,void 0,a.TransitionKind.internal,void 0,t)},t.prototype.to=function(t,e){return void 0===e&&(e=a.TransitionKind.external),new o.Transition(this,t,e)},t.prototype.defer=function(t){return this.deferrableTrigger.unshift(t),this},t.prototype.getTransition=function(t){for(var e,n=this,r=this.outgoing.length;r--;)this.outgoing[r].evaluate(t)&&(i.assert.ok(!e,function(){return"Multiple transitions found at "+n+" for "+t}),e=this.outgoing[r]);return e},t.prototype.doEnter=function(t){for(var e=this.onEnter.length;e--;)this.onEnter[e](t)},t.prototype.doLeave=function(t){for(var e=this.onLeave.length;e--;)this.onLeave[e](t)},t.prototype.toString=function(){return this.qualifiedName},t}();e.State=s},function(t,e,n){"use strict";e.__esModule=!0;var i=n(0),r=n(1),o=function(){function t(t,e,n,o,a){void 0===e&&(e=void 0),void 0===n&&(n=e?r.TransitionKind.external:r.TransitionKind.internal),void 0===o&&(o=void 0),void 0===a&&(a=function(){return!0});var s=this;this.userGuard=function(){return!0},this.actions=[],this.source=t,this.target=e||t,this.activation=new n(this.source,this.target),this.typeGuard=o?function(t){return t.constructor===o}:function(){return!0},this.userGuard=a,t.outgoing.unshift(this),i.log.info(function(){return"Created "+s},i.log.Create)}return t.prototype.on=function(t){return this.typeGuard=function(e){return e.constructor===t},this},t.prototype.when=function(t){return this.userGuard=t,this},t.prototype.to=function(t,e){var n=this;return void 0===e&&(e=r.TransitionKind.external),this.target=t,this.activation=new e(this.source,this.target),i.log.info(function(){return"- converted to "+n},i.log.Create),this},t.prototype.do=function(t){return this.actions.unshift(t),this},t.prototype.evaluate=function(t){return this.typeGuard(t)&&this.userGuard(t)},t.prototype.doActions=function(t){for(var e=this.actions.length;e--;)this.actions[e](t)},t.prototype.toString=function(){return this.activation+" transition from "+this.source+" to "+this.target},t}();e.Transition=o},function(t,e,n){"use strict";e.__esModule=!0;var i=n(5);e.PseudoStateKind=i.PseudoStateKind;var r=n(2);e.State=r.State;var o=n(6);e.Region=o.Region;var a=n(8);e.PseudoState=a.PseudoState;var s=n(3);e.Transition=s.Transition;var u=n(1);e.TransitionKind=u.TransitionKind;var c=n(7);e.ExternalTransitionActivation=c.ExternalTransitionActivation,e.LocalTransitionActivation=c.LocalTransitionActivation,e.InternalTransitionActivation=c.InternalTransitionActivation},function(t,e,n){"use strict";e.__esModule=!0,function(t){t.Initial="initial",t.ShallowHistory="shallow history",t.DeepHistory="deep history",t.Junction="junction",t.Choice="choice"}(e.PseudoStateKind||(e.PseudoStateKind={}))},function(t,e,n){"use strict";e.__esModule=!0;var i=n(0),r=function(){function t(t,e){var n=this;this.name=t,this.parent=e,this.children=[],this.qualifiedName=e+"."+t,this.parent.children.unshift(this),i.log.info(function(){return"Created region "+n},i.log.Create)}return t.prototype.toString=function(){return this.qualifiedName},t}();e.Region=r},function(t,e,n){"use strict";e.__esModule=!0;var i=n(0),r=n(8),o=n(2),a=function(){function t(t,e){var n=i.tree.ancestors(t,function(t){return t.parent}),o=i.tree.ancestors(e,function(t){return t.parent}),a=i.tree.lca(n,o)+1,s=o.length-(e instanceof r.PseudoState&&e.isHistory()?1:0);this.toExit=n[a],this.toEnter=o.slice(a,s).reverse()}return t.prototype.toString=function(){return"external"},t}();e.ExternalTransitionActivation=a;var s=function(){function t(t,e){this.target=e}return t.prototype.toString=function(){return"local"},t}();e.LocalTransitionActivation=s;var u=function(){function t(t,e){if(!(t instanceof o.State))throw new Error("Source of local transition must be a State.");this.source=t}return t.prototype.toString=function(){return"internal"},t}();e.InternalTransitionActivation=u},function(t,e,n){"use strict";e.__esModule=!0;var i=n(0),r=n(5),o=n(2),a=n(3),s=n(1),u=function(){function t(t,e,n){void 0===n&&(n=r.PseudoStateKind.Initial);var a=this;this.name=t,this.kind=n,this.outgoing=[],this.parent=e instanceof o.State?e.getDefaultRegion():e,this.qualifiedName=this.parent+"."+this.name,(this.kind===r.PseudoStateKind.Initial||this.isHistory())&&(i.assert.ok(!this.parent.starting,function(){return"Only one initial pseudo state is allowed in region "+a.parent}),this.parent.starting=this),this.parent.children.unshift(this),i.log.info(function(){return"Created "+a.kind+" pseudo state "+a},i.log.Create)}return t.prototype.isHistory=function(){return this.kind===r.PseudoStateKind.DeepHistory||this.kind===r.PseudoStateKind.ShallowHistory},t.prototype.on=function(t){return new a.Transition(this,void 0,s.TransitionKind.internal,t)},t.prototype.when=function(t){return new a.Transition(this,void 0,s.TransitionKind.internal,void 0,t)},t.prototype.to=function(t){return new a.Transition(this,t,s.TransitionKind.external)},t.prototype.else=function(t){var e=this;return i.assert.ok(this.kind===r.PseudoStateKind.Choice||this.kind===r.PseudoStateKind.Junction,function(){return"Else transitions are only valid at Choice and Junction pseudo states"}),i.assert.ok(!this.elseTransition,function(){return"Only 1 else transition allowed at "+e}),this.elseTransition=new a.Transition(this,t,s.TransitionKind.external,void 0,function(){return!1})},t.prototype.getTransition=function(t){var e=this,n=this.outgoing.filter(function(e){return e.evaluate(t)});i.assert.ok(this.kind===r.PseudoStateKind.Choice||n.length<=1,function(){return"Multiple transitions found at "+e+" for "+t});var o=(this.kind===r.PseudoStateKind.Choice?n[i.random.get(n.length)]:n[0])||this.elseTransition;return i.assert.ok(o,function(){return"Unable to find transition at "+e+" for "+t}),o},t.prototype.toString=function(){return this.qualifiedName},t}();e.PseudoState=u},function(t,e,n){"use strict";e.__esModule=!0;var i=n(15);e.Instance=i.Instance;var r=n(16);e.evaluate=r.evaluate},function(t,e,n){"use strict";e.__esModule=!0;var i=n(4);e.PseudoStateKind=i.PseudoStateKind,e.State=i.State,e.Region=i.Region,e.PseudoState=i.PseudoState,e.Transition=i.Transition,e.TransitionKind=i.TransitionKind;var r=n(9);e.Instance=r.Instance;var o=n(0);e.log=o.log,e.random=o.random},function(t,e,n){"use strict";e.__esModule=!0,function(t){t.ok=function(t,e){if(!t)throw new Error(e())}}(e.assert||(e.assert={}))},function(t,e,n){"use strict";e.__esModule=!0,function(t){t.Create=1,t.Entry=2,t.Exit=4,t.Evaluate=8,t.Transition=16,t.Transaction=32,t.User=64,t.All=t.Create|t.Entry|t.Exit|t.Evaluate|t.Transition|t.Transaction|t.User;var e=[];t.add=function(n,i){return void 0===i&&(i=t.All),e.push({callback:n,category:i})-1},t.remove=function(t){e[t]=void 0},t.info=function(t,n){for(var i,r=e.length;r--;){var o=e[r];o&&o.category&n&&o.callback(i||(i=t()))}}}(e.log||(e.log={}))},function(t,e,n){"use strict";e.__esModule=!0,function(t){t.get=function(t){return Math.floor(Math.random()*t)},t.set=function(e){var n=t.get;return t.get=e,n}}(e.random||(e.random={}))},function(t,e,n){"use strict";e.__esModule=!0,function(t){t.ancestors=function(t,e){for(var n=[];t;)n.unshift(t),t=e(t);return n},t.lca=function(t,e){for(var n=Math.min(t.length,e.length),i=0;i<n&&t[i]===e[i];)i++;return i-(i!==n?1:2)}}(e.tree||(e.tree={}))},function(t,e,n){"use strict";e.__esModule=!0;var i=n(0),r=n(9),o=function(){function t(t,e){var n=this;this.name=t,this.root=e,this.cleanState={},this.dirtyState={},this.dirtyVertex={},this.deferredEventPool=[],i.assert.ok(!e.parent,function(){return"The state provided as the root for an instance cannot have a parent"}),this.transaction(function(){return n.root.enter(n,!1,n.root)})}return t.prototype.evaluate=function(t){var e=this;return i.log.info(function(){return e+" evaluate "+t},i.log.Evaluate),this.transaction(function(){var n=r.evaluate(e.root,e,!1,t);return n&&0!==e.deferredEventPool.length&&e.evaluateDeferred(),n})},t.prototype.defer=function(t,e){var n=this;i.log.info(function(){return n+" deferred "+e+" while in "+t},i.log.Evaluate),this.deferredEventPool.push(e)},t.prototype.evaluateDeferred=function(){for(var t=this,e=this.deferrableTriggers(this.root),n=function(n){var a=o.deferredEventPool[n];if(a&&-1===e.indexOf(a.constructor)&&(delete o.deferredEventPool[n],i.log.info(function(){return t+" evaluate deferred "+a},i.log.Evaluate),r.evaluate(o.root,o,!1,a)))return o.evaluateDeferred(),"break"},o=this,a=0;a<this.deferredEventPool.length;a++){if("break"===n(a))break}},t.prototype.deferrableTriggers=function(t){var e=this;return t.children.reduce(function(t,n){return t.concat(e.deferrableTriggers(e.getState(n)))},t.deferrableTrigger)},t.prototype.transaction=function(t){try{for(var e=t(),n=Object.keys(this.dirtyState),i=n.length;i--;)this.cleanState[n[i]]=this.dirtyState[n[i]];return e}finally{this.dirtyState={},this.dirtyVertex={},this.deferredEventPool=this.deferredEventPool.filter(function(t){return t})}},t.prototype.setVertex=function(t){t.parent&&(this.dirtyVertex[t.parent.qualifiedName]=t)},t.prototype.setState=function(t){t.parent&&(this.dirtyVertex[t.parent.qualifiedName]=t,this.dirtyState[t.parent.qualifiedName]=t)},t.prototype.getState=function(t){return this.dirtyState[t.qualifiedName]||this.cleanState[t.qualifiedName]},t.prototype.getVertex=function(t){return this.dirtyVertex[t.qualifiedName]||this.cleanState[t.qualifiedName]},t.prototype.getLastKnownState=function(t){return this.cleanState[t.qualifiedName]},t.prototype.toString=function(){return this.name},t}();e.Instance=o},function(t,e,n){"use strict";var i=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};e.__esModule=!0;var r=i(n(4)),o=n(0);function a(t,e,n,i){var r=function(t,e,n,i){for(var r=!1,o=t.children.length;o--&&(!a(e.getState(t.children[o]),e,n,i)||(r=!0,!t.parent||e.getState(t.parent)===t)););return r}(t,e,n,i)||s(t,e,n,i)||function(t,e,n){var i=!1;-1!==t.deferrableTrigger.indexOf(n.constructor)&&(e.defer(t,n),i=!0);return i}(t,e,i);return r&&t.parent&&e.getState(t.parent)===t&&u(t,e,n,t),r}function s(t,e,n,i){var o=!1,a=t.getTransition(i);return a&&(!function(t,e,n,i){var o=[t];for(;t.target instanceof r.PseudoState&&t.target.kind===r.PseudoStateKind.Junction;)o.unshift(t=t.target.getTransition(i));for(var a=o.length;a--;)o[a].execute(e,n,i)}(a,e,n,i),o=!0),o}function u(t,e,n,i){for(var r=t.children.length;r--;)if(!e.getState(t.children[r]).isFinal())return;s(t,e,n,i)}function c(t,e){return!t.parent||c(t.parent.parent,e)&&e.getVertex(t.parent)===t}e.evaluate=a,r.Region.prototype.enter=r.State.prototype.enter=r.PseudoState.prototype.enter=function(t,e,n){this.enterHead(t,e,n,void 0),this.enterTail(t,e,n)},r.Region.prototype.enterHead=function(t,e,n,i){var r=this;o.log.info(function(){return t+" enter "+r},o.log.Entry)},r.Region.prototype.enterTail=function(t,e,n){var i,a=this,s=this.starting;(e||this.starting&&this.starting.isHistory())&&(i=t.getState(this))&&(s=i,e=e||this.starting.kind===r.PseudoStateKind.DeepHistory),o.assert.ok(s,function(){return t+" no initial pseudo state found at "+a}),s.enter(t,e,n)},r.Region.prototype.leave=function(t,e,n){var i=this;t.getVertex(this).leave(t,e,n),o.log.info(function(){return t+" leave "+i},o.log.Exit)},r.PseudoState.prototype.enterHead=function(t,e,n,i){var r=this;o.log.info(function(){return t+" enter "+r},o.log.Entry),t.setVertex(this)},r.PseudoState.prototype.enterTail=function(t,e,n){this.kind!==r.PseudoStateKind.Junction&&s(this,t,e,n)},r.PseudoState.prototype.leave=function(t,e,n){var i=this;o.log.info(function(){return t+" leave "+i},o.log.Exit)},r.State.prototype.enterHead=function(t,e,n,i){var r=this;if(i)for(var a=0,s=this.children;a<s.length;a++){var u=s[a];u!==i&&u.enter(t,e,n)}o.log.info(function(){return t+" enter "+r},o.log.Entry),t.setState(this),this.doEnter(n)},r.State.prototype.enterTail=function(t,e,n){for(var i=this.children.length;i--;)this.children[i].enter(t,e,n);u(this,t,e,this)},r.State.prototype.leave=function(t,e,n){for(var i=this,r=this.children.length;r--;)this.children[r].leave(t,e,n);o.log.info(function(){return t+" leave "+i},o.log.Exit),this.doLeave(n)},r.Transition.prototype.execute=function(t,e,n){var i=this;o.log.info(function(){return"Executing "+i},o.log.Transition),this.activation.exitSource(t,e,n),this.doActions(n),this.activation.enterTarget(t,e,n)},r.ExternalTransitionActivation.prototype.exitSource=function(t,e,n){this.toExit.leave(t,e,n)},r.ExternalTransitionActivation.prototype.enterTarget=function(t,e,n){for(var i=this.toEnter.length;i--;)this.toEnter[i].enterHead(t,e,n,this.toEnter[i-1]);this.toEnter[0].enterTail(t,e,n)},r.LocalTransitionActivation.prototype.exitSource=function(t,e,n){for(this.vertexToEnter=this.target;this.vertexToEnter.parent&&!c(this.vertexToEnter.parent.parent,t);)this.vertexToEnter=this.vertexToEnter.parent.parent;!c(this.vertexToEnter,t)&&this.vertexToEnter.parent&&t.getVertex(this.vertexToEnter.parent).leave(t,e,n)},r.LocalTransitionActivation.prototype.enterTarget=function(t,e,n){this.vertexToEnter&&!c(this.vertexToEnter,t)&&this.vertexToEnter.enter(t,e,n)},r.InternalTransitionActivation.prototype.exitSource=function(t,e,n){},r.InternalTransitionActivation.prototype.enterTarget=function(t,e,n){u(this.source,t,e,this.source)}}]);