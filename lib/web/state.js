var state=function(t){var n={};function e(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,e),r.l=!0,r.exports}return e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:i})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(e.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var r in t)e.d(i,r,function(n){return t[n]}.bind(null,r));return i},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=8)}([function(t,n,e){"use strict";n.__esModule=!0;var i=e(9);n.assert=i.assert;var r=e(10);n.log=r.log;var o=e(11);n.random=o.random;var a=e(12);n.tree=a.tree},function(t,n,e){"use strict";n.__esModule=!0;var i=e(0),r=e(6),o=e(3),a=e(2),s=function(){function t(n,e){void 0===e&&(e=void 0);var r=this;this.name=n,this.outgoing=[],this.children=[],this.onEnter=[],this.onLeave=[],this.deferrableTrigger=[],this.parent=e instanceof t?e.getDefaultRegion():e,this.parent?(i.assert.ok(!this.parent.children.filter(function(n){return n instanceof t&&n.name===r.name}).length,function(){return"State names must be unique within a region"}),this.qualifiedName=this.parent+"."+n,this.parent.children.unshift(this)):this.qualifiedName=n,i.log.info(function(){return"Created state "+r},i.log.Create)}return t.prototype.getDefaultRegion=function(){return this.defaultRegion||(this.defaultRegion=new r.Region(this.name,this))},t.prototype.isSimple=function(){return 0===this.children.length},t.prototype.isComposite=function(){return this.children.length>=1},t.prototype.isOrthogonal=function(){return this.children.length>=2},t.prototype.isFinal=function(){return 0===this.outgoing.length},t.prototype.entry=function(t){return this.onEnter.unshift(t),this},t.prototype.exit=function(t){return this.onLeave.unshift(t),this},t.prototype.on=function(t){return new o.Transition(this,void 0,a.TransitionKind.internal,t)},t.prototype.when=function(t){return new o.Transition(this,void 0,a.TransitionKind.internal,void 0,t)},t.prototype.external=function(t){return this.to(t)},t.prototype.to=function(t){return void 0===t&&(t=void 0),new o.Transition(this,t)},t.prototype.internal=function(){return this.to()},t.prototype.local=function(t){return new o.Transition(this,t,a.TransitionKind.local)},t.prototype.defer=function(t){return this.deferrableTrigger.unshift(t),this},t.prototype.getTransition=function(t){for(var n,e=this,r=this.outgoing.length;r--;)this.outgoing[r].evaluate(t)&&(i.assert.ok(!n,function(){return"Multiple transitions found at "+e+" for "+t}),n=this.outgoing[r]);return n},t.prototype.toString=function(){return this.qualifiedName},t}();n.State=s},function(t,n,e){"use strict";n.__esModule=!0;var i=e(7);!function(t){t[t.external=0]="external",t[t.internal=1]="internal",t[t.local=2]="local"}(n.TransitionKind||(n.TransitionKind={})),function(t){t.map=[i.ExternalTransitionActivation,i.InternalTransitionActivation,i.LocalTransitionActivation]}(n.TransitionKind||(n.TransitionKind={}))},function(t,n,e){"use strict";n.__esModule=!0;var i=e(0),r=e(2),o=function(){function t(t,n,e,o,a){void 0===n&&(n=void 0),void 0===e&&(e=n?r.TransitionKind.external:r.TransitionKind.internal),void 0===o&&(o=void 0),void 0===a&&(a=function(){return!0});var s=this;this.userGuard=function(){return!0},this.actions=[],this.source=t,this.target=n||t,this.activation=new r.TransitionKind.map[e](this.source,this.target),this.typeGuard=o?function(t){return t.constructor===o}:function(){return!0},this.userGuard=a,t.outgoing.unshift(this),i.log.info(function(){return"Created "+s},i.log.Create)}return t.prototype.on=function(t){return this.typeGuard=function(n){return n.constructor===t},this},t.prototype.when=function(t){return this.userGuard=t,this},t.prototype.to=function(t,n){var e=this;return void 0===n&&(n=r.TransitionKind.external),this.target=t,this.activation=new r.TransitionKind.map[n](this.source,this.target),i.log.info(function(){return"- converted to "+e},i.log.Create),this},t.prototype.do=function(t){return this.actions.unshift(t),this},t.prototype.evaluate=function(t){return this.typeGuard(t)&&this.userGuard(t)},t.prototype.doActions=function(t){for(var n=this.actions.length;n--;)this.actions[n](t)},t.prototype.if=function(t){return this.when(t)},t.prototype.local=function(t){return void 0===t&&(t=void 0),(this.target=t||this.target)&&(this.activation=new r.TransitionKind.map[r.TransitionKind.local](this.source,this.target)),this},t.prototype.effect=function(t){return this.do(t)},t.prototype.toString=function(){return this.activation+" transition from "+this.source+" to "+this.target},t}();n.Transition=o},function(t,n,e){"use strict";n.__esModule=!0,function(t){t.Initial="initial",t.ShallowHistory="shallow history",t.DeepHistory="deep history",t.Junction="junction",t.Choice="choice"}(n.PseudoStateKind||(n.PseudoStateKind={}))},function(t,n,e){"use strict";n.__esModule=!0;var i=e(0),r=e(4),o=e(1),a=e(3),s=e(2),u=function(){function t(t,n,e){void 0===e&&(e=r.PseudoStateKind.Initial);var a=this;this.name=t,this.kind=e,this.outgoing=[],this.parent=n instanceof o.State?n.getDefaultRegion():n,this.qualifiedName=this.parent+"."+this.name,(this.kind===r.PseudoStateKind.Initial||this.isHistory())&&(i.assert.ok(!this.parent.starting,function(){return"Only one initial pseudo state is allowed in region "+a.parent}),this.parent.starting=this),this.parent.children.unshift(this),i.log.info(function(){return"Created "+a.kind+" pseudo state "+a},i.log.Create)}return t.prototype.isHistory=function(){return this.kind===r.PseudoStateKind.DeepHistory||this.kind===r.PseudoStateKind.ShallowHistory},t.prototype.on=function(t){return new a.Transition(this,void 0,s.TransitionKind.internal,t)},t.prototype.when=function(t){return new a.Transition(this,void 0,s.TransitionKind.internal,void 0,t)},t.prototype.to=function(t){return new a.Transition(this,t)},t.prototype.external=function(t){return this.to(t)},t.prototype.else=function(t){var n=this;return i.assert.ok(this.kind===r.PseudoStateKind.Choice||this.kind===r.PseudoStateKind.Junction,function(){return"Else transitions are only valid at Choice and Junction pseudo states"}),i.assert.ok(!this.elseTransition,function(){return"Only 1 else transition allowed at "+n}),this.elseTransition=new a.Transition(this,t,s.TransitionKind.external,void 0,function(){return!1})},t.prototype.getTransition=function(t){var n=this.kind===r.PseudoStateKind.Choice?this.getChoiceTransition(t):this.getOtherTransition(t);if(!n)throw new Error("No outgoing transition found at "+this);return n},t.prototype.getChoiceTransition=function(t){for(var n=[],e=this.outgoing.length;e--;)this.outgoing[e].evaluate(t)&&n.push(this.outgoing[e]);return n[i.random.get(n.length)]||this.elseTransition},t.prototype.getOtherTransition=function(t){for(var n,e=this.outgoing.length;e--;)this.outgoing[e].evaluate(t)&&(n=this.outgoing[e]);return n||this.elseTransition},t.prototype.toString=function(){return this.qualifiedName},t}();n.PseudoState=u},function(t,n,e){"use strict";n.__esModule=!0;var i=e(0),r=function(){function t(t,n){var e=this;this.name=t,this.parent=n,this.children=[],this.qualifiedName=n+"."+t,this.parent.children.unshift(this),i.log.info(function(){return"Created region "+e},i.log.Create)}return t.prototype.toString=function(){return this.qualifiedName},t}();n.Region=r},function(t,n,e){"use strict";n.__esModule=!0;var i=e(0),r=e(5),o=e(1),a=function(){function t(t,n){var e=i.tree.ancestors(t,function(t){return t.parent}),o=i.tree.ancestors(n,function(t){return t.parent}),a=i.tree.lca(e,o)+1,s=o.length-(n instanceof r.PseudoState&&n.isHistory()?1:0);this.toExit=e[a],this.toEnter=o.slice(a,s).reverse()}return t.prototype.toString=function(){return"external"},t}();n.ExternalTransitionActivation=a;var s=function(){function t(t,n){this.target=n}return t.prototype.toString=function(){return"local"},t}();n.LocalTransitionActivation=s;var u=function(){function t(t,n){if(!(t instanceof o.State))throw new Error("Source of local transition must be a State.");this.source=t}return t.prototype.toString=function(){return"internal"},t}();n.InternalTransitionActivation=u},function(t,n,e){"use strict";n.__esModule=!0;var i=e(4);n.PseudoStateKind=i.PseudoStateKind;var r=e(2);n.TransitionKind=r.TransitionKind;var o=e(1);n.State=o.State;var a=e(5);n.PseudoState=a.PseudoState;var s=e(6);n.Region=s.Region;var u=e(3);n.Transition=u.Transition;var c=e(13);n.Instance=c.Instance;var h=e(0);n.log=h.log,n.random=h.random},function(t,n,e){"use strict";n.__esModule=!0,function(t){t.ok=function(t,n){if(!t)throw new Error(n())}}(n.assert||(n.assert={}))},function(t,n,e){"use strict";n.__esModule=!0,function(t){t.Create=1,t.Entry=2,t.Exit=4,t.Evaluate=8,t.Transition=16,t.Transaction=32,t.User=64,t.All=t.Create|t.Entry|t.Exit|t.Evaluate|t.Transition|t.Transaction|t.User;var n=[];t.add=function(e,i){return void 0===i&&(i=t.All),n.push({callback:e,category:i})-1},t.remove=function(t){n[t]=void 0},t.info=function(t,e){for(var i,r=n.length;r--;){var o=n[r];o&&o.category&e&&o.callback(i||(i=t()))}}}(n.log||(n.log={}))},function(t,n,e){"use strict";n.__esModule=!0,function(t){t.get=function(t){return Math.floor(Math.random()*t)},t.set=function(n){var e=t.get;return t.get=n,e}}(n.random||(n.random={}))},function(t,n,e){"use strict";n.__esModule=!0,function(t){t.ancestors=function(t,n){for(var e=[];t;)e.unshift(t),t=n(t);return e},t.lca=function(t,n){for(var e=Math.min(t.length,n.length),i=0;i<e&&t[i]===n[i];)i++;return i-(i!==e?1:2)}}(n.tree||(n.tree={}))},function(t,n,e){"use strict";n.__esModule=!0;var i=e(0),r=e(1),o=e(14),a=function(){function t(t,n,e){void 0===e&&(e=void 0);var r=this;this.name=t,this.root=n,this.cleanState={},this.dirtyState={},this.dirtyVertex={},this.deferredEventPool=[],i.assert.ok(!n.parent,function(){return"The state provided as the root for an instance cannot have a parent"}),e?this.transaction(function(){return r.stateFromJSON(r.root,e)}):this.transaction(function(){return r.root.enter(r,!1,r.root)})}return t.prototype.evaluate=function(t){var n=this;return i.log.info(function(){return n+" evaluate "+t},i.log.Evaluate),this.transaction(function(){var e=o.evaluate(n.root,n,!1,t);return e&&0!==n.deferredEventPool.length&&(n.evaluateDeferred(),n.deferredEventPool=n.deferredEventPool.filter(function(t){return t})),e})},t.prototype.defer=function(t,n){var e=this;i.log.info(function(){return e+" deferred "+n+" while in "+t},i.log.Evaluate),this.deferredEventPool.unshift(n)},t.prototype.evaluateDeferred=function(){for(var t=this,n=this.deferrableTriggers(this.root),e=function(e){var a=r.deferredEventPool[e];if(a&&-1===n.indexOf(a.constructor)&&(delete r.deferredEventPool[e],i.log.info(function(){return t+" evaluate deferred "+a},i.log.Evaluate),o.evaluate(r.root,r,!1,a)))return r.evaluateDeferred(),"break"},r=this,a=this.deferredEventPool.length;a--;){if("break"===e(a))break}},t.prototype.deferrableTriggers=function(t){var n=this;return t.children.reduce(function(t,e){return t.concat(n.deferrableTriggers(n.getState(e)))},t.deferrableTrigger)},t.prototype.transaction=function(t){try{for(var n=t(),e=Object.keys(this.dirtyState),i=e.length;i--;)this.cleanState[e[i]]=this.dirtyState[e[i]];return n}finally{this.dirtyState={},this.dirtyVertex={}}},t.prototype.setVertex=function(t){t.parent&&(this.dirtyVertex[t.parent.qualifiedName]=t)},t.prototype.setState=function(t){t.parent&&(this.dirtyVertex[t.parent.qualifiedName]=t,this.dirtyState[t.parent.qualifiedName]=t)},t.prototype.getState=function(t){return this.dirtyState[t.qualifiedName]||this.cleanState[t.qualifiedName]},t.prototype.getVertex=function(t){return this.dirtyVertex[t.qualifiedName]||this.cleanState[t.qualifiedName]},t.prototype.getLastKnownState=function(t){return this.cleanState[t.qualifiedName]},t.prototype.toJSON=function(t){var n=this;return void 0===t&&(t=this.root),{name:t.name,children:t.children.map(function(t){return n.regionToJSON(t)}).reverse()}},t.prototype.regionToJSON=function(t){var n=this,e=this.getLastKnownState(t);return{name:t.name,children:t.children.filter(function(t){return t instanceof r.State}).reverse().map(function(t){return n.toJSON(t)}),lastKnownState:e?e.name:void 0}},t.prototype.stateFromJSON=function(t,n){for(var e=function(e,o){var a=n.children[e],s=t.children.filter(function(t){return t.name===a.name})[0];i.assert.ok(s,function(){return"Unable to find region "+a.name}),r.regionFromJSON(s,a)},r=this,o=0,a=n.children.length;o<a;++o)e(o)},t.prototype.regionFromJSON=function(t,n){for(var e=function(e,a){var s=n.children[e],u=t.children.filter(function(t){return t instanceof r.State&&t.name===s.name})[0];i.assert.ok(u,function(){return"Unable to find state "+s.name}),o.stateFromJSON(u,s),u.name===n.lastKnownState&&o.setState(u)},o=this,a=0,s=n.children.length;a<s;++a)e(a)},t.prototype.toString=function(){return this.name},t}();n.Instance=a},function(t,n,e){"use strict";n.__esModule=!0;var i=e(0),r=e(4),o=e(1),a=e(5),s=e(6),u=e(3),c=e(7);function h(t,n,e,i){var r=function(t,n,e,i){for(var r=!1,o=t.children.length;o--&&(!h(n.getState(t.children[o]),n,e,i)||(r=!0,!t.parent||n.getState(t.parent)===t)););return r}(t,n,e,i)||f(t,n,e,i)||function(t,n,e){var i=!1;-1!==t.deferrableTrigger.indexOf(e.constructor)&&(n.defer(t,e),i=!0);return i}(t,n,i);return r&&t.parent&&n.getState(t.parent)===t&&l(t,n,e,t),r}function f(t,n,e,i){var o=!1,s=t.getTransition(i);return s&&(!function(t,n,e,i){var o=[t];for(;t.target instanceof a.PseudoState&&t.target.kind===r.PseudoStateKind.Junction;)o.unshift(t=t.target.getTransition(i));for(var s=o.length;s--;)o[s].execute(n,e,i)}(s,n,e,i),o=!0),o}function l(t,n,e,i){for(var r=t.children.length;r--;)if(!n.getState(t.children[r]).isFinal())return;f(t,n,e,i)}function d(t,n){return!t.parent||d(t.parent.parent,n)&&n.getVertex(t.parent)===t}n.evaluate=h,s.Region.prototype.enter=o.State.prototype.enter=a.PseudoState.prototype.enter=function(t,n,e){this.enterHead(t,n,e,void 0),this.enterTail(t,n,e)},s.Region.prototype.enterHead=function(t,n,e,r){var o=this;i.log.info(function(){return t+" enter "+o},i.log.Entry)},s.Region.prototype.enterTail=function(t,n,e){var o,a=this,s=this.starting;(n||this.starting&&this.starting.isHistory())&&(o=t.getState(this))&&(s=o,n=n||this.starting.kind===r.PseudoStateKind.DeepHistory),i.assert.ok(s,function(){return t+" no initial pseudo state found at "+a}),s.enter(t,n,e)},s.Region.prototype.leave=function(t,n,e){var r=this;t.getVertex(this).leave(t,n,e),i.log.info(function(){return t+" leave "+r},i.log.Exit)},a.PseudoState.prototype.enterHead=function(t,n,e,r){var o=this;i.log.info(function(){return t+" enter "+o},i.log.Entry),t.setVertex(this)},a.PseudoState.prototype.enterTail=function(t,n,e){this.kind!==r.PseudoStateKind.Junction&&f(this,t,n,e)},a.PseudoState.prototype.leave=function(t,n,e){var r=this;i.log.info(function(){return t+" leave "+r},i.log.Exit)},o.State.prototype.enterHead=function(t,n,e,r){var o=this;if(r)for(var a=this.children.length;a--;)this.children[a]!==r&&this.children[a].enter(t,n,e);i.log.info(function(){return t+" enter "+o},i.log.Entry),t.setState(this);for(a=this.onEnter.length;a--;)this.onEnter[a](e)},o.State.prototype.enterTail=function(t,n,e){for(var i=this.children.length;i--;)this.children[i].enter(t,n,e);l(this,t,n,this)},o.State.prototype.leave=function(t,n,e){for(var r=this,o=this.children.length;o--;)this.children[o].leave(t,n,e);i.log.info(function(){return t+" leave "+r},i.log.Exit);for(var a=this.onLeave.length;a--;)this.onLeave[a](e)},u.Transition.prototype.execute=function(t,n,e){var r=this;i.log.info(function(){return"Executing "+r},i.log.Transition),this.activation.exitSource(t,n,e),this.doActions(e),this.activation.enterTarget(t,n,e)},c.ExternalTransitionActivation.prototype.exitSource=function(t,n,e){this.toExit.leave(t,n,e)},c.ExternalTransitionActivation.prototype.enterTarget=function(t,n,e){for(var i=this.toEnter.length;i--;)this.toEnter[i].enterHead(t,n,e,this.toEnter[i-1]);this.toEnter[0].enterTail(t,n,e)},c.LocalTransitionActivation.prototype.exitSource=function(t,n,e){for(this.vertexToEnter=this.target;this.vertexToEnter.parent&&!d(this.vertexToEnter.parent.parent,t);)this.vertexToEnter=this.vertexToEnter.parent.parent;!d(this.vertexToEnter,t)&&this.vertexToEnter.parent&&t.getVertex(this.vertexToEnter.parent).leave(t,n,e)},c.LocalTransitionActivation.prototype.enterTarget=function(t,n,e){this.vertexToEnter&&!d(this.vertexToEnter,t)&&this.vertexToEnter.enter(t,n,e)},c.InternalTransitionActivation.prototype.exitSource=function(t,n,e){},c.InternalTransitionActivation.prototype.enterTarget=function(t,n,e){l(this.source,t,n,this.source)}}]);