var state=function(t){var n={};function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}return e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:r})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var i in t)e.d(r,i,function(n){return t[n]}.bind(null,i));return r},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=0)}([function(t,n,e){"use strict";n.__esModule=!0;var r=e(4);n.PseudoStateKind=r.PseudoStateKind;var i=e(5);n.TransitionKind=i.TransitionKind;var o=e(9);n.State=o.State;var a=e(13);n.Region=a.Region;var s=e(14);n.PseudoState=s.PseudoState;var u=e(15);n.Transition=u.Transition;var c=e(16);n.Instance=c.Instance;var f=e(1);n.log=f.log,n.random=f.random},function(t,n,e){"use strict";n.__esModule=!0;var r=e(10);n.assert=r.assert;var i=e(11);n.log=i.log;var o=e(12);n.random=o.random},function(t,n,e){"use strict";var r=this&&this.__extends||function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}();n.__esModule=!0;var i=e(1),o=e(3),a=e(0),s=function(t){function n(n,e){var r=t.call(this,n,e instanceof a.State?e.getDefaultRegion():e)||this;return r.outgoing=[],r.parent&&r.parent.children.unshift(r),r}return r(n,t),n.prototype.isActive=function(t){return!this.parent||this.parent.parent.isActive(t)&&t.getVertex(this.parent)===this},n.prototype.accept=function(t,n,e){var r=!1,i=this.getTransition(e);return i&&(i.traverse(t,n,e),r=!0),r},n.prototype.getTransition=function(t){for(var n,e=this,r=this.outgoing.length;r--;)this.outgoing[r].evaluate(t)&&(i.assert.ok(!n,function(){return"Multiple transitions found at "+e+" for "+t}),n=this.outgoing[r]);return n},n}(o.NamedElement);n.Vertex=s},function(t,n,e){"use strict";n.__esModule=!0;var r=e(1),i=function(){function t(t,n){var e=this;this.name=t,this.parent=n,this.qualifiedName=n?n+"."+t:t,r.log.info(function(){return"Created "+e},r.log.Create)}return t.prototype.enter=function(t,n,e){this.enterHead(t,n,e,void 0),this.enterTail(t,n,e)},t.prototype.toString=function(){return this.qualifiedName},t}();n.NamedElement=i},function(t,n,e){"use strict";n.__esModule=!0,function(t){t.Initial="initial",t.ShallowHistory="shallow history",t.DeepHistory="deep history",t.Junction="junction",t.Choice="choice"}(n.PseudoStateKind||(n.PseudoStateKind={}))},function(t,n,e){"use strict";n.__esModule=!0;var r=e(6),i=e(7),o=e(8);!function(t){t[t.external=0]="external",t[t.local=1]="local",t[t.internal=2]="internal"}(n.TransitionKind||(n.TransitionKind={})),function(t){t.map=[r.ExternalTransitionActivation,i.LocalTransitionActivation,o.InternalTransitionActivation]}(n.TransitionKind||(n.TransitionKind={}))},function(t,n,e){"use strict";n.__esModule=!0;var r=e(0),i=function(){function t(t,n){var e=o(t,function(t){return t.parent}),i=o(n,function(t){return t.parent}),a=function(t,n){var e=Math.min(t.length,n.length),r=0;for(;r<e&&t[r]===n[r];)r++;return r-(r!==e?1:2)}(e,i)+1,s=i.length-(n instanceof r.PseudoState&&n.isHistory()?1:0);this.toExit=e[a],this.toEnter=i.slice(a,s).reverse()}return t.prototype.exitSource=function(t,n,e){this.toExit.leave(t,n,e)},t.prototype.enterTarget=function(t,n,e){for(var r=this.toEnter.length;r--;)this.toEnter[r].enterHead(t,n,e,this.toEnter[r-1]);this.toEnter[0].enterTail(t,n,e)},t.prototype.toString=function(){return"external"},t}();function o(t,n){for(var e=[];t;)e.unshift(t),t=n(t);return e}n.ExternalTransitionActivation=i},function(t,n,e){"use strict";n.__esModule=!0;var r=function(){function t(t,n){this.target=n}return t.prototype.exitSource=function(t,n,e){for(this.toEnter=this.target;this.toEnter.parent&&!this.toEnter.parent.parent.isActive(t);)this.toEnter=this.toEnter.parent.parent;!this.toEnter.isActive(t)&&this.toEnter.parent&&t.getVertex(this.toEnter.parent).leave(t,n,e)},t.prototype.enterTarget=function(t,n,e){this.toEnter&&!this.toEnter.isActive(t)&&this.toEnter.enter(t,n,e)},t.prototype.toString=function(){return"local"},t}();n.LocalTransitionActivation=r},function(t,n,e){"use strict";n.__esModule=!0;var r=e(0),i=function(){function t(t,n){if(!(t instanceof r.State))throw new Error("Source of local transition must be a State.");this.source=t}return t.prototype.exitSource=function(t,n,e){},t.prototype.enterTarget=function(t,n,e){this.source.completion(t,n,this.source)},t.prototype.toString=function(){return"internal"},t}();n.InternalTransitionActivation=i},function(t,n,e){"use strict";var r=this&&this.__extends||function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}();n.__esModule=!0;var i=e(1),o=e(2),a=e(0),s=function(t){function n(n,e){void 0===e&&(e=void 0);var r=t.call(this,n,e)||this;return r.name=n,r.children=[],r.onEnter=[],r.onLeave=[],r.deferrableTrigger=[],r}return r(n,t),n.prototype.getDefaultRegion=function(){return this.defaultRegion||(this.defaultRegion=new a.Region(this.name,this))},n.prototype.isSimple=function(){return 0===this.children.length},n.prototype.isComposite=function(){return this.children.length>=1},n.prototype.isOrthogonal=function(){return this.children.length>=2},n.prototype.isFinal=function(){return 0===this.outgoing.length},n.prototype.entry=function(t){return this.onEnter.unshift(t),this},n.prototype.exit=function(t){return this.onLeave.unshift(t),this},n.prototype.on=function(t){return new a.Transition(this,void 0,a.TransitionKind.internal,t)},n.prototype.when=function(t){return new a.Transition(this,void 0,a.TransitionKind.internal,void 0,t)},n.prototype.to=function(t,n){return void 0===n&&(n=a.TransitionKind.external),new a.Transition(this,t,n)},n.prototype.defer=function(t){return this.deferrableTrigger.unshift(t),this},n.prototype.evaluate=function(t,n,e){var r=this.delegate(t,n,e)||this.accept(t,n,e)||this.deferTrigger(t,e);return r&&this.parent&&t.getState(this.parent)===this&&this.completion(t,n,this),r},n.prototype.delegate=function(t,n,e){for(var r=!1,i=this.children.length;i--&&(!t.getState(this.children[i]).evaluate(t,n,e)||(r=!0,!this.parent||t.getState(this.parent)===this)););return r},n.prototype.deferTrigger=function(t,n){var e=!1;return-1!==this.deferrableTrigger.indexOf(n.constructor)&&(t.defer(this,n),e=!0),e},n.prototype.enterHead=function(t,n,e,r){var o=this;if(r)for(var a=this.children.length;a--;)this.children[a]!==r&&this.children[a].enter(t,n,e);i.log.info(function(){return t+" enter "+o},i.log.Entry),t.setState(this);for(a=this.onEnter.length;a--;)this.onEnter[a](e)},n.prototype.enterTail=function(t,n,e){for(var r=this.children.length;r--;)this.children[r].enter(t,n,e);this.completion(t,n,this)},n.prototype.leave=function(t,n,e){for(var r=this,o=this.children.length;o--;)this.children[o].leave(t,n,e);i.log.info(function(){return t+" leave "+r},i.log.Exit);for(var a=this.onLeave.length;a--;)this.onLeave[a](e)},n.prototype.completion=function(t,n,e){for(var r=this.children.length;r--;)if(!t.getState(this.children[r]).isFinal())return;this.accept(t,n,e)},n}(o.Vertex);n.State=s},function(t,n,e){"use strict";n.__esModule=!0,function(t){t.ok=function(t,n){if(!t)throw new Error(n())}}(n.assert||(n.assert={}))},function(t,n,e){"use strict";n.__esModule=!0,function(t){t.Create=1,t.Entry=2,t.Exit=4,t.Evaluate=8,t.Transition=16,t.Transaction=32,t.User=64,t.All=t.Create|t.Entry|t.Exit|t.Evaluate|t.Transition|t.Transaction|t.User;var n=[];t.add=function(e,r){return void 0===r&&(r=t.All),n.push({callback:e,category:r})-1},t.remove=function(t){n[t]=void 0},t.info=function(t,e){for(var r,i=n.length;i--;){var o=n[i];o&&o.category&e&&o.callback(r||(r=t()))}}}(n.log||(n.log={}))},function(t,n,e){"use strict";n.__esModule=!0,function(t){t.get=function(t){return Math.floor(Math.random()*t)},t.set=function(n){var e=t.get;return t.get=n,e}}(n.random||(n.random={}))},function(t,n,e){"use strict";var r=this&&this.__extends||function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}();n.__esModule=!0;var i=e(1),o=e(0),a=function(t){function n(n,e){var r=t.call(this,n,e)||this;return r.children=[],r.parent.children.unshift(r),r}return r(n,t),n.prototype.enterHead=function(t,n,e,r){var o=this;i.log.info(function(){return t+" enter "+o},i.log.Entry)},n.prototype.enterTail=function(t,n,e){var r,a=this,s=this.starting;(n||this.starting&&this.starting.isHistory())&&(r=t.getState(this))&&(s=r,n=n||this.starting.kind===o.PseudoStateKind.DeepHistory),i.assert.ok(s,function(){return t+" no initial pseudo state found at "+a}),s.enter(t,n,e)},n.prototype.leave=function(t,n,e){var r=this;t.getVertex(this).leave(t,n,e),i.log.info(function(){return t+" leave "+r},i.log.Exit)},n}(e(3).NamedElement);n.Region=a},function(t,n,e){"use strict";var r=this&&this.__extends||function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}();n.__esModule=!0;var i=e(1),o=e(0),a=function(t){function n(n,e,r){void 0===r&&(r=o.PseudoStateKind.Initial);var i=t.call(this,n,e)||this;return i.name=n,i.kind=r,(i.kind===o.PseudoStateKind.Initial||i.isHistory())&&(i.parent.starting=i),i}return r(n,t),n.prototype.isHistory=function(){return this.kind===o.PseudoStateKind.DeepHistory||this.kind===o.PseudoStateKind.ShallowHistory},n.prototype.on=function(t){return new o.Transition(this,void 0,o.TransitionKind.internal,t)},n.prototype.when=function(t){return new o.Transition(this,void 0,o.TransitionKind.internal,void 0,t)},n.prototype.to=function(t){return new o.Transition(this,t,o.TransitionKind.external)},n.prototype.else=function(t){var n=this;return i.assert.ok(this.kind===o.PseudoStateKind.Choice||this.kind===o.PseudoStateKind.Junction,function(){return"Else transitions are only valid at Choice and Junction pseudo states"}),i.assert.ok(!this.elseTransition,function(){return"Only 1 else transition allowed at "+n}),this.elseTransition=new o.Transition(this,t,o.TransitionKind.external,void 0,function(){return!1})},n.prototype.getTransition=function(n){var e=this,r=(this.kind!==o.PseudoStateKind.Choice?t.prototype.getTransition.call(this,n):this.getChoiceTransition(n))||this.elseTransition;return i.assert.ok(r,function(){return"Unable to find transition at "+e+" for "+n}),r},n.prototype.getChoiceTransition=function(t){for(var n=[],e=this.outgoing.length;e--;)this.outgoing[e].evaluate(t)&&n.unshift(this.outgoing[e]);return n[i.random.get(n.length)]},n.prototype.enterHead=function(t,n,e,r){var o=this;i.log.info(function(){return t+" enter "+o},i.log.Entry),t.setVertex(this)},n.prototype.enterTail=function(t,n,e){this.kind!==o.PseudoStateKind.Junction&&this.accept(t,n,e)},n.prototype.leave=function(t,n,e){var r=this;i.log.info(function(){return t+" leave "+r},i.log.Exit)},n}(e(2).Vertex);n.PseudoState=a},function(t,n,e){"use strict";n.__esModule=!0;var r=e(1),i=e(0),o=function(){function t(t,n,e,o,a){void 0===n&&(n=void 0),void 0===e&&(e=n?i.TransitionKind.external:i.TransitionKind.internal),void 0===o&&(o=void 0),void 0===a&&(a=function(){return!0});var s=this;this.userGuard=function(){return!0},this.onTraverse=[],this.source=t,this.target=n||t,this.activation=new i.TransitionKind.map[e](this.source,this.target),this.typeGuard=o?function(t){return t.constructor===o}:function(){return!0},this.userGuard=a,t.outgoing.unshift(this),r.log.info(function(){return"Created "+s},r.log.Create)}return t.prototype.on=function(t){return this.typeGuard=function(n){return n.constructor===t},this},t.prototype.when=function(t){return this.userGuard=t,this},t.prototype.to=function(t,n){var e=this;return void 0===n&&(n=i.TransitionKind.external),this.target=t,this.activation=new i.TransitionKind.map[n](this.source,this.target),r.log.info(function(){return"- converted to "+e},r.log.Create),this},t.prototype.do=function(t){return this.onTraverse.unshift(t),this},t.prototype.evaluate=function(t){return this.typeGuard(t)&&this.userGuard(t)},t.prototype.traverse=function(t,n,e){for(var o=this,a=[o];o.target instanceof i.PseudoState&&o.target.kind===i.PseudoStateKind.Junction;)a.unshift(o=o.target.getTransition(e));for(var s=function(i){r.log.info(function(){return"Executing "+a[i]},r.log.Transition),a[i].activation.exitSource(t,n,e);for(var o=a[i].onTraverse.length;o--;)a[i].onTraverse[o](e);a[i].activation.enterTarget(t,n,e)},u=a.length;u--;)s(u)},t.prototype.toString=function(){return this.activation+" transition from "+this.source+" to "+this.target},t}();n.Transition=o},function(t,n,e){"use strict";n.__esModule=!0;var r=e(1),i=function(){function t(t,n){var e=this;this.name=t,this.root=n,this.cleanState={},this.dirtyState={},this.dirtyVertex={},this.deferredEventPool=[],r.assert.ok(!n.parent,function(){return"The state provided as the root for an instance cannot have a parent"}),this.transaction(function(){return e.root.enter(e,!1,e.root)})}return t.prototype.evaluate=function(t){var n=this;return r.log.info(function(){return n+" evaluate "+t},r.log.Evaluate),this.transaction(function(){var e=n.root.evaluate(n,!1,t);return e&&0!==n.deferredEventPool.length&&(n.evaluateDeferred(),n.deferredEventPool=n.deferredEventPool.filter(function(t){return t})),e})},t.prototype.defer=function(t,n){var e=this;r.log.info(function(){return e+" deferred "+n+" while in "+t},r.log.Evaluate),this.deferredEventPool.unshift(n)},t.prototype.evaluateDeferred=function(){for(var t=this,n=this.deferrableTriggers(this.root),e=function(e){var o=i.deferredEventPool[e];if(o&&-1===n.indexOf(o.constructor)&&(delete i.deferredEventPool[e],r.log.info(function(){return t+" evaluate deferred "+o},r.log.Evaluate),i.root.evaluate(i,!1,o)))return i.evaluateDeferred(),"break"},i=this,o=this.deferredEventPool.length;o--;){if("break"===e(o))break}},t.prototype.deferrableTriggers=function(t){var n=this;return t.children.reduce(function(t,e){return t.concat(n.deferrableTriggers(n.getState(e)))},t.deferrableTrigger)},t.prototype.transaction=function(t){try{for(var n=t(),e=Object.keys(this.dirtyState),r=e.length;r--;)this.cleanState[e[r]]=this.dirtyState[e[r]];return n}finally{this.dirtyState={},this.dirtyVertex={}}},t.prototype.setVertex=function(t){t.parent&&(this.dirtyVertex[t.parent.qualifiedName]=t)},t.prototype.setState=function(t){t.parent&&(this.dirtyVertex[t.parent.qualifiedName]=t,this.dirtyState[t.parent.qualifiedName]=t)},t.prototype.getState=function(t){return this.dirtyState[t.qualifiedName]||this.cleanState[t.qualifiedName]},t.prototype.getVertex=function(t){return this.dirtyVertex[t.qualifiedName]||this.cleanState[t.qualifiedName]},t.prototype.getLastKnownState=function(t){return this.cleanState[t.qualifiedName]},t.prototype.toString=function(){return this.name},t}();n.Instance=i}]);