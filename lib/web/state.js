var state=function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=8)}([function(t,e,n){"use strict";e.__esModule=!0;var r=n(9);e.assert=r.assert;var i=n(10);e.log=i.log;var o=n(11);e.random=o.random;var a=n(12);e.tree=a.tree},function(t,e,n){"use strict";e.__esModule=!0;var r=n(3);e.PseudoStateKind=r.PseudoStateKind;var i=n(4);e.State=i.State;var o=n(5);e.Region=o.Region;var a=n(6);e.PseudoState=a.PseudoState;var s=n(2);e.Transition=s.Transition},function(t,e,n){"use strict";e.__esModule=!0;var r=n(0),i=n(6),o=function(){function t(t){this.source=t,this.typeTest=function(){return!0},this.guard=function(){return!0},this.toEnter=[],this.actions=[],t.outgoing.unshift(this),r.log.info(function(){return"Created transition from "+t},r.log.Create)}return t.prototype.on=function(t){return this.typeTest=function(e){return e.constructor===t},this},t.prototype.when=function(t){return this.guard=t,this},t.prototype.if=function(t){return this.when(t)},t.prototype.to=function(t){this.target=t;var e=r.tree.ancestors(this.source,function(t){return t.parent}),n=r.tree.ancestors(t,function(t){return t.parent}),o=r.tree.lca(e,n)+1,a=n.length-(t instanceof i.PseudoState&&t.isHistory()?1:0);return this.toLeave=e[o],this.toEnter=n.slice(o,a).reverse(),this},t.prototype.local=function(t){var e=this;if(void 0===t&&(t=void 0),this.target=this.target||t){var n=r.tree.ancestors(this.target,function(t){return t.parent});r.assert.ok(-1!==n.indexOf(this.source),function(){return"Source vertex ("+e.source+") must an ancestor of the target vertex ("+e.target+")"});var o=n.indexOf(this.source)+2,a=n.length-(this.target instanceof i.PseudoState&&this.target.isHistory()?1:0);this.toLeave=n[o],this.toEnter=n.slice(o,a).reverse()}return this},t.prototype.do=function(t){return this.actions.unshift(t),this},t.prototype.effect=function(t){return this.do(t)},t.prototype.evaluate=function(t){return this.typeTest(t)&&this.guard(t)},t}();e.Transition=o},function(t,e,n){"use strict";e.__esModule=!0,function(t){t[t.Initial=1]="Initial",t[t.ShallowHistory=2]="ShallowHistory",t[t.DeepHistory=4]="DeepHistory",t[t.Junction=8]="Junction",t[t.Choice=16]="Choice"}(e.PseudoStateKind||(e.PseudoStateKind={}))},function(t,e,n){"use strict";e.__esModule=!0;var r=n(0),i=n(5),o=n(2),a=function(){function t(e,n){void 0===n&&(n=void 0);var i=this;this.name=e,this.outgoing=[],this.children=[],this.onEnter=[],this.onLeave=[],this.deferrableTrigger=[],this.parent=n instanceof t?n.getDefaultRegion():n,this.parent?(r.assert.ok(!this.parent.children.filter(function(e){return e instanceof t&&e.name===i.name}).length,function(){return"State names must be unique within a region"}),this.qualifiedName=this.parent+"."+e,this.parent.children.unshift(this)):this.qualifiedName=e,r.log.info(function(){return"Created "+i},r.log.Create)}return t.prototype.getDefaultRegion=function(){return this.defaultRegion||(this.defaultRegion=new i.Region(this.name,this))},t.prototype.isSimple=function(){return 0===this.children.length},t.prototype.isComposite=function(){return this.children.length>=1},t.prototype.isOrthogonal=function(){return this.children.length>=2},t.prototype.entry=function(t){return this.onEnter.unshift(t),this},t.prototype.exit=function(t){return this.onLeave.unshift(t),this},t.prototype.on=function(t){return new o.Transition(this).on(t)},t.prototype.external=function(t){return new o.Transition(this).to(t)},t.prototype.to=function(t){return t?this.external(t):this.internal()},t.prototype.internal=function(){return new o.Transition(this)},t.prototype.local=function(t){return new o.Transition(this).local(t)},t.prototype.defer=function(t){return this.deferrableTrigger.unshift(t),this},t.prototype.toString=function(){return this.qualifiedName},t}();e.State=a},function(t,e,n){"use strict";e.__esModule=!0;var r=n(0),i=function(){function t(t,e){var n=this;this.name=t,this.parent=e,this.children=[],this.qualifiedName=e+"."+t,this.parent.children.unshift(this),r.log.info(function(){return"Created "+n},r.log.Create)}return t.prototype.toString=function(){return this.qualifiedName},t}();e.Region=i},function(t,e,n){"use strict";e.__esModule=!0;var r=n(0),i=n(3),o=n(4),a=n(2),s=function(){function t(t,e,n){void 0===n&&(n=i.PseudoStateKind.Initial);var a=this;this.name=t,this.kind=n,this.outgoing=[],this.parent=e instanceof o.State?e.getDefaultRegion():e,this.qualifiedName=this.parent+"."+this.name,(this.kind===i.PseudoStateKind.Initial||this.isHistory())&&(r.assert.ok(!this.parent.starting,function(){return"Only one initial pseudo state is allowed in region "+a.parent}),this.parent.starting=this),this.parent.children.unshift(this),r.log.info(function(){return"Created "+a},r.log.Create)}return t.prototype.isHistory=function(){return this.kind===i.PseudoStateKind.DeepHistory||this.kind===i.PseudoStateKind.ShallowHistory},t.prototype.on=function(t){return new a.Transition(this).on(t)},t.prototype.to=function(t){return new a.Transition(this).to(t)},t.prototype.external=function(t){return this.to(t)},t.prototype.else=function(t){var e=this;return r.assert.ok(this.kind===i.PseudoStateKind.Choice||this.kind===i.PseudoStateKind.Junction,function(){return"Else transitions are only valid at Choice and Junction pseudo states"}),r.assert.ok(!this.elseTransition,function(){return"Only 1 else transition allowed at "+e}),this.elseTransition=new a.Transition(this).if(function(){return!1}).to(t)},t.prototype.toString=function(){return this.qualifiedName},t}();e.PseudoState=s},function(t,e,n){"use strict";e.__esModule=!0;var r=n(13);e.Instance=r.Instance;var i=n(14);e.evaluate=i.evaluate},function(t,e,n){"use strict";e.__esModule=!0;var r=n(1);e.PseudoStateKind=r.PseudoStateKind,e.State=r.State,e.Region=r.Region,e.PseudoState=r.PseudoState,e.Transition=r.Transition;var i=n(7);e.Instance=i.Instance;var o=n(0);e.log=o.log,e.random=o.random},function(t,e,n){"use strict";e.__esModule=!0,function(t){t.ok=function(t,e){if(!t)throw new Error(e())}}(e.assert||(e.assert={}))},function(t,e,n){"use strict";e.__esModule=!0,function(t){t.Create=1,t.Entry=2,t.Exit=4,t.Evaluate=8,t.Transition=16,t.Transaction=32,t.User=64,t.All=t.Create|t.Entry|t.Exit|t.Evaluate|t.Transition|t.Transaction|t.User;var e=[];t.add=function(n,r){return void 0===r&&(r=t.All),e.push({callback:n,category:r})-1},t.remove=function(t){e[t]=void 0},t.info=function(t,n){for(var r,i=e.length;i--;){var o=e[i];o&&o.category&n&&o.callback(r||(r=t()))}}}(e.log||(e.log={}))},function(t,e,n){"use strict";e.__esModule=!0,function(t){t.get=function(t){return Math.floor(Math.random()*t)},t.set=function(e){var n=t.get;return t.get=e,n}}(e.random||(e.random={}))},function(t,e,n){"use strict";e.__esModule=!0,function(t){t.ancestors=function(t,e){for(var n=[];t;)n.unshift(t),t=e(t);return n},t.lca=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n&&t[r]===e[r];)r++;return r-(r!==n?1:2)}}(e.tree||(e.tree={}))},function(t,e,n){"use strict";var r=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};e.__esModule=!0;var i=r(n(1)),o=n(0),a=n(7),s=function(){function t(t,e,n){void 0===n&&(n=void 0);var r=this;this.name=t,this.root=e,this.cleanState={},this.dirtyState={},this.dirtyVertex={},this.deferredEventPool=[],o.assert.ok(!e.parent,function(){return"The state provided as the root for an instance cannot have a parent"}),n?this.transaction(function(){return r.stateFromJSON(r.root,n)}):this.transaction(function(){return r.root.enter(r,!1,void 0)})}return t.prototype.evaluate=function(t){var e=this;return o.log.info(function(){return e+" evaluate "+t},o.log.Evaluate),this.transaction(function(){var n=a.evaluate(e.root,e,!1,t);return e.deferredEventPool.length>0&&e.processDeferredEvents(),n})},t.prototype.defer=function(t,e){var n=this;o.log.info(function(){return n+" deferred "+e+" while in "+t},o.log.Evaluate),this.deferredEventPool.push(e)},t.prototype.processDeferredEvents=function(){for(var t=this,e=this.activeStateConfigurationDeferrableTriggers(this.root),n=function(n){var i=r.deferredEventPool[n];i&&-1===e.indexOf(i.constructor)&&(delete r.deferredEventPool[n],o.log.info(function(){return t+" evaluate deferred "+i},o.log.Evaluate),a.evaluate(r.root,r,!1,i)&&r.processDeferredEvents())},r=this,i=0;i<this.deferredEventPool.length;i++)n(i)},t.prototype.activeStateConfigurationDeferrableTriggers=function(t){for(var e=t.deferrableTrigger.slice(),n=t.children.length;n--;)e=e.concat(this.activeStateConfigurationDeferrableTriggers(this.getState(t.children[n])));return e},t.prototype.transaction=function(t){try{for(var e=t(),n=Object.keys(this.dirtyState),r=n.length;r--;)this.cleanState[n[r]]=this.dirtyState[n[r]];return e}finally{this.dirtyState={},this.dirtyVertex={},this.deferredEventPool=this.deferredEventPool.filter(function(t){return t})}},t.prototype.setVertex=function(t){t.parent&&(this.dirtyVertex[t.parent.qualifiedName]=t)},t.prototype.setState=function(t){this.setVertex(t),t.parent&&(this.dirtyState[t.parent.qualifiedName]=t)},t.prototype.getState=function(t){return this.dirtyState[t.qualifiedName]||this.cleanState[t.qualifiedName]},t.prototype.getVertex=function(t){return this.dirtyVertex[t.qualifiedName]||this.cleanState[t.qualifiedName]},t.prototype.getLastKnownState=function(t){return this.cleanState[t.qualifiedName]},t.prototype.toJSON=function(t){var e=this;return void 0===t&&(t=this.root),{name:t.name,children:t.children.map(function(t){return e.regionToJSON(t)}).reverse()}},t.prototype.regionToJSON=function(t){var e=this,n=this.getLastKnownState(t);return{name:t.name,children:t.children.filter(function(t){return t instanceof i.State}).reverse().map(function(t){return e.toJSON(t)}),lastKnownState:n?n.name:void 0}},t.prototype.stateFromJSON=function(t,e){for(var n=function(e){var n=t.children.filter(function(t){return t.name===e.name})[0];o.assert.ok(n,function(){return"Unable to find region "+e.name}),r.regionFromJSON(n,e)},r=this,i=0,a=e.children;i<a.length;i++){n(a[i])}},t.prototype.regionFromJSON=function(t,e){for(var n=function(n){var a=t.children.filter(function(t){return t instanceof i.State&&t.name===n.name})[0];o.assert.ok(a,function(){return"Unable to find state "+n.name}),r.stateFromJSON(a,n),a.name===e.lastKnownState&&r.setState(a)},r=this,a=0,s=e.children;a<s.length;a++){n(s[a])}},t.prototype.toString=function(){return this.name},t}();e.Instance=s},function(t,e,n){"use strict";var r=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};e.__esModule=!0;var i=r(n(1)),o=n(0);function a(t,e,n,r){var i=function(t,e,n,r){for(var i=!1,o=t.children.length;o--&&(!a(e.getState(t.children[o]),e,n,r)||(i=!0,!t.parent||e.getState(t.parent)===t)););return i}(t,e,n,r)||s(t,e,n,r)||function(t,e,n){var r=!1;-1!==t.deferrableTrigger.indexOf(n.constructor)&&(e.defer(t,n),r=!0);return r}(t,e,r);return i&&t.parent&&e.getState(t.parent)===t&&f(t,e,n,t),i}function s(t,e,n,r){var o=!1,a=t.getTransition(r);return a&&(!function(t,e,n,r){var o=[t];for(;t.target instanceof i.PseudoState&&t.target.kind===i.PseudoStateKind.Junction;)o.unshift(t=t.target.getTransition(r));for(var a=o.length;a--;)o[a].execute(e,n,r)}(a,e,n,r),o=!0),o}function u(t,e){for(var n,r=t.outgoing.length;r--;)t.outgoing[r].evaluate(e)&&(o.assert.ok(!n,function(){return"Multiple transitions found at "+t+" for "+e}),n=t.outgoing[r]);return n}function f(t,e,n,r){for(var i=t.children.length;i--;)if(0!==e.getState(t.children[i]).outgoing.length)return;s(t,e,n,r)}e.evaluate=a,i.Region.prototype.enter=i.State.prototype.enter=i.PseudoState.prototype.enter=function(t,e,n){this.enterHead(t,e,n),this.enterTail(t,e,n)},i.Region.prototype.enterHead=function(t,e,n){var r=this;o.log.info(function(){return t+" enter "+r},o.log.Entry)},i.Region.prototype.enterTail=function(t,e,n){var r,a=this,s=this.starting;(e||this.starting&&this.starting.isHistory())&&(r=t.getState(this))&&(s=r,e=e||this.starting.kind===i.PseudoStateKind.DeepHistory),o.assert.ok(s,function(){return t+" no initial pseudo state found at "+a}),s.enter(t,e,n)},i.Region.prototype.leave=function(t,e,n){var r=this;t.getVertex(this).leave(t,e,n),o.log.info(function(){return t+" leave "+r},o.log.Exit)},i.PseudoState.prototype.getTransition=function(t){var e=this,n=(this.kind===i.PseudoStateKind.Choice?function(t,e){for(var n=[],r=t.outgoing.length;r--;)t.outgoing[r].evaluate(e)&&n.push(t.outgoing[r]);return n[o.random.get(n.length)]}:u)(this,t)||this.elseTransition;return o.assert.ok(n,function(){return"Unable to find transition at "+e+" for "+t}),n},i.PseudoState.prototype.enterHead=function(t,e,n){var r=this;o.log.info(function(){return t+" enter "+r},o.log.Entry),t.setVertex(this)},i.PseudoState.prototype.enterTail=function(t,e,n){this.kind!==i.PseudoStateKind.Junction&&s(this,t,e,n)},i.PseudoState.prototype.leave=function(t,e,n){var r=this;o.log.info(function(){return t+" leave "+r},o.log.Exit)},i.State.prototype.getTransition=function(t){return u(this,t)},i.State.prototype.enterHead=function(t,e,n){var r=this;o.log.info(function(){return t+" enter "+r},o.log.Entry),t.setState(this);for(var i=this.onEnter.length;i--;)this.onEnter[i](n)},i.State.prototype.enterTail=function(t,e,n){for(var r=this.children.length;r--;)this.children[r].enter(t,e,n);f(this,t,e,this)},i.State.prototype.leave=function(t,e,n){for(var r=this,i=this.children.length;i--;)this.children[i].leave(t,e,n);for(o.log.info(function(){return t+" leave "+r},o.log.Exit),i=this.onLeave.length;i--;)this.onLeave[i](n)},i.Transition.prototype.execute=function(t,e,n){var r=this;o.log.info(function(){return"Executing transition from "+r.source+" to "+r.target},o.log.Transition),this.toLeave&&this.toLeave.leave(t,e,n);for(var a=this.actions.length;a--;)this.actions[a](n);for(a=this.toEnter.length;a--;)this.toEnter[a].enterHead(t,e,n);0!==this.toEnter.length&&this.toEnter[0].enterTail(t,e,n),!this.target&&this.source instanceof i.State&&f(this.source,t,e,this.target)}}]);