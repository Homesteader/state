var state=function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=12)}([function(t,e,n){"use strict";var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();e.__esModule=!0;var r=function(t){function e(e,n){var i=t.call(this,e,n)||this;return i.children=new Array,i.parent.children.push(i),i}return i(e,t),e.prototype.isActive=function(t){return this.parent.isActive(t)},e.prototype.isComplete=function(t){var e=t.getLastKnownState(this);return void 0!==e&&e.isFinal()},e.prototype.accept=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return t.visitRegion.apply(t,[this].concat(e))},e.defaultName="default",e}(n(4).NamedElement);e.Region=r},function(t,e,n){"use strict";e.__esModule=!0,function(t){t[t.External=0]="External",t[t.Internal=1]="Internal",t[t.Local=2]="Local"}(e.TransitionKind||(e.TransitionKind={}))},function(t,e,n){"use strict";var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();e.__esModule=!0;var r=n(11),o=n(9),a=n(7),s=n(6),c=n(5),u=n(1),l=n(0),p=n(8),f=function(t){function e(e,n,i){void 0===i&&(i=c.PseudoStateKind.Initial);var r=t.call(this,e,n)||this;return r.kind=i,r}return i(e,t),e.prototype.accept=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return t.visitPseudoState.apply(t,[this].concat(e))},e}(p.Vertex);e.PseudoState=f;var h=function(t){function e(e,n){var i=t.call(this,e,n)||this;return i.children=new Array,i.entryBehavior=o.create(),i.exitBehavior=o.create(),i}return i(e,t),e.prototype.isFinal=function(){return 0===this.outgoing.length},e.prototype.isSimple=function(){return 0===this.children.length},e.prototype.isComposite=function(){return this.children.length>0},e.prototype.isOrthogonal=function(){return this.children.length>1},e.prototype.isActive=function(t){return this.parent.isActive(t)&&t.getLastKnownState(this.parent)===this},e.prototype.exit=function(t){return void 0!==t&&null!==t&&(this.exitBehavior=o.create(this.exitBehavior,function(e,n){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];return t.apply(void 0,[e].concat(i))}),this.invalidate()),this},e.prototype.entry=function(t){return void 0!==t&&null!==t&&(this.entryBehavior=o.create(this.entryBehavior,function(e,n){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];return t.apply(void 0,[e].concat(i))}),this.invalidate()),this},e.prototype.accept=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return t.visitState.apply(t,[this].concat(e))},e.prototype.defaultRegion=function(){return this.children.find(function(t){return t.name===l.Region.defaultName})},e.prototype.isComplete=function(t){return this.children.every(function(e){return e.isComplete(t)})},e}(p.Vertex);e.State=h;var v=function(){function t(t){this.name=t,this.parent=void 0,this.children=new Array,this.onInitialise=o.create()}return t.prototype.invalidate=function(){this.onInitialise=o.create()},t.prototype.isActive=function(t){return!0},t.prototype.initialise=function(t){t?(this.onInitialise===o.create()&&this.initialise(),a.logger.log("initialise "+t),this.onInitialise(t,!1)):(a.logger.log("initialise "+this),this.onInitialise=this.accept(new E,!1))},t.prototype.evaluate=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return this.onInitialise===o.create()&&this.initialise(),a.logger.log(t+" evaluate message: "+e),E.evaluate.apply(E,[this,t].concat(e))},t.prototype.accept=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return t.visitStateMachine.apply(t,[this].concat(e))},t.prototype.toString=function(){return this.name},t.prototype.defaultRegion=function(){return this.children.find(function(t){return t.name===l.Region.defaultName})},t.prototype.isComplete=function(t){return this.children.every(function(e){return e.isComplete(t)})},t}();e.StateMachine=v;var g=function(){function t(t,e,n){void 0===n&&(n=u.TransitionKind.External);var i=this;this.source=t,this.target=e,this.kind=n,this.effectBehavior=o.create(),this.onTraverse=o.create(),this.guard=t instanceof f?function(){return!0}:function(t,e){return e===i.source},this.source.outgoing.push(this),this.target?(this.target.incoming.push(this),this.kind===u.TransitionKind.Local&&(r.Tree.isChild(this.target,this.source)||(this.kind=u.TransitionKind.External))):this.kind=u.TransitionKind.Internal,this.source.invalidate()}return t.prototype.isElse=function(){return this.guard===t.Else},t.prototype.else=function(){return this.source instanceof f&&(this.source.kind===c.PseudoStateKind.Choice||this.source.kind===c.PseudoStateKind.Junction)&&(this.guard=t.Else),this},t.prototype.when=function(t){return void 0!==t&&null!==t&&(this.guard=t),this},t.prototype.effect=function(t){return void 0!==t&&null!==t&&(this.effectBehavior=o.create(this.effectBehavior,function(e,n){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];return t.apply(void 0,[e].concat(i))}),this.source.invalidate()),this},t.prototype.evaluate=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return this.guard.apply(this,[t].concat(e))},t.prototype.accept=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return t.visitTransition.apply(t,[this].concat(e))},t.internalTransitionsTriggerCompletion=!1,t.Else=function(){return!1},t}();e.Transition=g;var d=n(3),y=function(){return function(t){this.name=t,this.children=new Array}}(),m=function(){return function(t){this.name=t,this.current=void 0,this.lastKnownState=void 0,this.children=new Array}}(),S=function(){function t(t){this.root=new y(t)}return t.prototype.getStateConfiguration=function(t){var e=this.root;if(void 0!==t.parent){var n=this.getRegionConfiguration(t.parent);void 0===(e=n.children.find(function(e){return e.name===t.name}))&&(e=new y(t.name),n.children.push(e))}return e},t.prototype.getRegionConfiguration=function(t){var e=this.getStateConfiguration(t.parent),n=e.children.find(function(e){return e.name===t.name});return void 0===n&&(n=new m(t.name),e.children.push(n)),n},t.prototype.setCurrent=function(t){var e=this.getRegionConfiguration(t.parent);e.current=t.name,t instanceof h&&(e.lastKnownState=t.name)},t.prototype.getCurrent=function(t){var e=this.getRegionConfiguration(t);return t.children.find(function(t){return t.name===e.current})},t.prototype.getLastKnownState=function(t){for(var e,n=this.getRegionConfiguration(t),i=0,r=t.children;i<r.length;i++){var o=r[i];o instanceof h&&o.name===n.lastKnownState&&(e=o)}return e},t.prototype.toJSON=function(){return JSON.stringify(this.root)},t.prototype.toString=function(){return this.root.name},t}();e.JSONInstance=S;var _=function(){function t(t){this.name=t,this.lastState=new Map,this.currentVertex=new Map}return t.prototype.setCurrent=function(t){this.currentVertex.set(t.parent,t),t instanceof h&&this.lastState.set(t.parent,t)},t.prototype.getCurrent=function(t){return this.currentVertex.get(t)},t.prototype.getLastKnownState=function(t){return this.lastState.get(t)},t.prototype.toString=function(){return this.name},t}();e.DictionaryInstance=_;var A=function(){return function(){this.leave=o.create(),this.beginEnter=o.create(),this.endEnter=o.create()}}(),E=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.actions=new Map,e.transitions=new Array,e}return i(e,t),e.prototype.getActions=function(t){var e=this.actions.get(t);return e||this.actions.set(t,e=new A),e},e.prototype.visitElement=function(t){this.getActions(t).leave=o.create(this.getActions(t).leave,function(e){return a.logger.log(e+" leave "+t)}),this.getActions(t).beginEnter=o.create(this.getActions(t).beginEnter,function(e){return a.logger.log(e+" enter "+t)})},e.prototype.visitRegion=function(e,n){var i=this,r=e.children.reduce(function(t,e){return e instanceof f&&c.PseudoStateKind.isInitial(e.kind)&&(void 0===t||c.PseudoStateKind.isHistory(t.kind))?e:t},void 0);this.getActions(e).leave=o.create(this.getActions(e).leave,function(t,n){for(var r,o=[],a=2;a<arguments.length;a++)o[a-2]=arguments[a];(r=i.getActions(t.getCurrent(e))).leave.apply(r,[t,n].concat(o))}),t.prototype.visitRegion.call(this,e,n||r&&r.kind===c.PseudoStateKind.DeepHistory),n||!r||c.PseudoStateKind.isHistory(r.kind)?this.getActions(e).endEnter=o.create(this.getActions(e).endEnter,function(t,n){for(var o=[],a=2;a<arguments.length;a++)o[a-2]=arguments[a];var s=i.getActions((n||c.PseudoStateKind.isHistory(r.kind))&&t.getLastKnownState(e)||r),u=n||r.kind===c.PseudoStateKind.DeepHistory;s.beginEnter.apply(s,[t,u].concat(o)),s.endEnter.apply(s,[t,u].concat(o))}):this.getActions(e).endEnter=o.create(this.getActions(r).beginEnter,this.getActions(r).endEnter)},e.prototype.visitVertex=function(e,n){t.prototype.visitVertex.call(this,e,n),this.getActions(e).beginEnter=o.create(this.getActions(e).beginEnter,function(t){t.setCurrent(e)})},e.prototype.visitPseudoState=function(n,i){var r=this;t.prototype.visitPseudoState.call(this,n,i),c.PseudoStateKind.isInitial(n.kind)&&(this.getActions(n).endEnter=o.create(this.getActions(n).endEnter,function(t,i){for(var o,a,s,u,l=[],p=2;p<arguments.length;p++)l[p-2]=arguments[p];(c.PseudoStateKind.isHistory(n.kind)||i)&&(u=t.getLastKnownState(n.parent))?((o=r.getActions(n)).leave.apply(o,[t,!1].concat(l)),(a=r.getActions(u)).beginEnter.apply(a,[t,i||n.kind===c.PseudoStateKind.DeepHistory].concat(l)),(s=r.getActions(u)).endEnter.apply(s,[t,i||n.kind===c.PseudoStateKind.DeepHistory].concat(l))):e.traverse(n.outgoing[0],t,!1)}))},e.prototype.visitState=function(t,e){for(var n=0,i=t.children;n<i.length;n++){var r=i[n];r.accept(this,e),this.getActions(t).leave=o.create(this.getActions(t).leave,this.getActions(r).leave),this.getActions(t).endEnter=o.create(this.getActions(t).endEnter,this.getActions(r).beginEnter,this.getActions(r).endEnter)}this.visitVertex(t,e),this.getActions(t).leave=o.create(this.getActions(t).leave,t.exitBehavior),this.getActions(t).beginEnter=o.create(this.getActions(t).beginEnter,t.entryBehavior)},e.prototype.visitStateMachine=function(e,n){var i=this;t.prototype.visitStateMachine.call(this,e,n);for(var r=0,a=this.transitions;r<a.length;r++){var s=a[r];switch(s.kind){case u.TransitionKind.Internal:this.visitInternalTransition(s);break;case u.TransitionKind.Local:this.visitLocalTransition(s);break;case u.TransitionKind.External:this.visitExternalTransition(s)}}return o.create.apply(void 0,e.children.map(function(t){return o.create(i.getActions(t).beginEnter,i.getActions(t).endEnter)}))},e.prototype.visitTransition=function(e,n){t.prototype.visitTransition.call(this,e,n),this.transitions.push(e)},e.prototype.visitInternalTransition=function(t){t.onTraverse=o.create(t.effectBehavior),g.internalTransitionsTriggerCompletion&&(t.onTraverse=o.create(t.onTraverse,function(n,i){for(var r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];t.source instanceof h&&t.source.isComplete(n)&&e.evaluate(t.source,n,t.source)}))},e.prototype.visitLocalTransition=function(t){var e=this;t.onTraverse=o.create(function(n,i){for(var r=[],a=2;a<arguments.length;a++)r[a-2]=arguments[a];for(var s=t.target,c=o.create(e.getActions(t.target).endEnter);s!==t.source;)c=o.create(e.getActions(s).beginEnter,c),c=s.parent.parent===t.source?o.create(t.effectBehavior,e.getActions(n.getCurrent(s.parent)).leave,c):o.create(e.getActions(s.parent).beginEnter,c),s=s.parent.parent;c.apply(void 0,[n,i].concat(r))})},e.prototype.visitExternalTransition=function(t){var e=r.Tree.ancestors(t.source),n=r.Tree.ancestors(t.target),i=r.Tree.lowestCommonAncestorIndex(e,n);for(e[i]instanceof l.Region&&(i+=1),t.onTraverse=o.create(this.getActions(e[i]).leave,t.effectBehavior);i<n.length;)t.onTraverse=o.create(t.onTraverse,this.getActions(n[i++]).beginEnter);t.onTraverse=o.create(t.onTraverse,this.getActions(t.target).endEnter)},e.findElse=function(t){return t.outgoing.find(function(t){return t.isElse()})},e.selectTransition=function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var r=t.outgoing.filter(function(t){return t.evaluate.apply(t,[e].concat(n))});return t.kind===c.PseudoStateKind.Choice?0!==r.length?r[s.random(r.length)]:this.findElse(t):(r.length>1&&a.logger.error("Multiple outbound transition guards returned true at "+t+" for "+n),r.find(function(){return!0})||this.findElse(t))},e.evaluate=function(t,n){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];var o=!1;if(i[0]!==t)for(var s=0,c=t.children;s<c.length;s++){var u=c[s],l=n.getLastKnownState(u);if(l&&e.evaluate.apply(e,[l,n].concat(i))&&(o=!0,!t.isActive(n)))break}if(t instanceof h)if(o)i[0]!==t&&t.isComplete(n)&&e.evaluate(t,n,t);else{var p=t.outgoing.filter(function(t){return t.evaluate.apply(t,[n].concat(i))});1===p.length?(e.traverse.apply(e,[p[0],n].concat(i)),o=!0):p.length>1&&a.logger.error(t+": multiple outbound transitions evaluated true for message "+i)}return o},e.traverse=function(t,n){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];for(var a=o.create(t.onTraverse);t.target&&t.target instanceof f&&t.target.kind===c.PseudoStateKind.Junction;)t=e.selectTransition.apply(e,[t.target,n].concat(i)),a=o.create(a,t.onTraverse);a.apply(void 0,[n,!1].concat(i)),t.target&&(t.target instanceof f&&t.target.kind===c.PseudoStateKind.Choice?e.traverse.apply(e,[e.selectTransition.apply(e,[t.target,n].concat(i)),n].concat(i)):t.target instanceof h&&t.target.isComplete(n)&&e.evaluate(t.target,n,t.target))},e}(d.Visitor)},function(t,e,n){"use strict";e.__esModule=!0;var i=function(){function t(){}return t.prototype.visitElement=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n]},t.prototype.visitRegion=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var i=0,r=t.children;i<r.length;i++){var o=r[i];o.accept.apply(o,[this].concat(e))}return this.visitElement.apply(this,[t].concat(e))},t.prototype.visitVertex=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var i=0,r=t.outgoing;i<r.length;i++){var o=r[i];o.accept.apply(o,[this].concat(e))}return this.visitElement.apply(this,[t].concat(e))},t.prototype.visitPseudoState=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return this.visitVertex.apply(this,[t].concat(e))},t.prototype.visitState=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var i=0,r=t.children;i<r.length;i++){var o=r[i];o.accept.apply(o,[this].concat(e))}return this.visitVertex.apply(this,[t].concat(e))},t.prototype.visitStateMachine=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var i=0,r=t.children;i<r.length;i++){var o=r[i];o.accept.apply(o,[this].concat(e))}return this.visitElement.apply(this,[t].concat(e))},t.prototype.visitTransition=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n]},t}();e.Visitor=i},function(t,e,n){"use strict";e.__esModule=!0;var i=function(){function t(t,e){this.name=t,this.parent=e,this.invalidate()}return t.prototype.invalidate=function(){this.parent.invalidate()},t.prototype.toString=function(){return this.parent.toString()+t.separator+this.name},t.separator=".",t}();e.NamedElement=i},function(t,e,n){"use strict";e.__esModule=!0,function(t){t[t.Choice=0]="Choice",t[t.DeepHistory=1]="DeepHistory",t[t.Initial=2]="Initial",t[t.Junction=3]="Junction",t[t.ShallowHistory=4]="ShallowHistory"}(e.PseudoStateKind||(e.PseudoStateKind={})),function(t){t.isHistory=function(e){return e===t.DeepHistory||e===t.ShallowHistory},t.isInitial=function(e){return e===t.DeepHistory||e===t.Initial||e===t.ShallowHistory}}(e.PseudoStateKind||(e.PseudoStateKind={}))},function(t,e,n){"use strict";e.__esModule=!0,e.random=function(t){return Math.floor(Math.random()*t)},e.setRandom=function(t){var n=e.random;return e.random=t,n}},function(t,e,n){"use strict";e.__esModule=!0,e.logger=console,e.setLogger=function(t){var n=e.logger;return e.logger=t,n}},function(t,e,n){"use strict";var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();e.__esModule=!0;var r=n(1),o=n(4),a=n(0),s=n(2),c=function(t){function e(e,n){var i=t.call(this,e,n instanceof a.Region?n:n.defaultRegion()||new a.Region(a.Region.defaultName,n))||this;return i.outgoing=new Array,i.incoming=new Array,i.parent.children.push(i),i}return i(e,t),e.prototype.to=function(t,e){return void 0===e&&(e=r.TransitionKind.External),new s.Transition(this,t,e)},e}(o.NamedElement);e.Vertex=c},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){return[]};function r(t){return t!==i&&void 0!==t&&null!==t}e.create=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t.filter(r);return 0!==n.length?function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return n.map(function(e){return e.apply(void 0,t)})}:i}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.ancestors=function(t){for(var e=[],n=t;void 0!==n;n=n.parent)e.unshift(n);return e},t.lowestCommonAncestorIndex=function(t,e){var n=0;if(void 0!==t&&void 0!==e)for(var i=Math.min(t.length,e.length);n<i&&t[n]===e[n];)n++;return n-1},t.isChild=function(t,e){for(var n=t;void 0!==n;n=n.parent)if(n.parent===e)return!0;return!1},t.depth=function(t){for(var e=-1,n=t;void 0!==n;n=n.parent)e++;return e}}(e.Tree||(e.Tree={}))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(10);e.Tree=i.Tree},function(t,e,n){"use strict";e.__esModule=!0;var i=n(7);e.setLogger=i.setLogger;var r=n(6);e.setRandom=r.setRandom;var o=n(5);e.PseudoStateKind=o.PseudoStateKind;var a=n(1);e.TransitionKind=a.TransitionKind;var s=n(0);e.Region=s.Region;var c=n(3);e.Visitor=c.Visitor,function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(n(2))}]);